<!--<button (click)="debugpre = !debugpre" style="position:fixed;top:0;left:100px;color:black;z-index: 99999999;">Show debug</button>
<pre *ngIf="debugpre" style="position: absolute;width:70%;top:0;z-index: 9999999;">
&lt;!&ndash;    <div style="float:left;width:50%">
        <button (click)="testToken()">testtoken</button>
    </div>&ndash;&gt;
</pre>-->
<div class="main_content studies">
    <div id="clipboard" class="clipboard said"  *ngIf="clipBoardNotEmpty()">
        <div id="clipboardtoggle" class="toggle_button" (click)="showClipboardContent = !showClipboardContent">
            <i id="clipboardtoggle_icon" class="glyphicon glyphicon-copy"></i>
        </div>
        <div class="content" id="clipboard_content" *ngIf="showClipboardContent">
            <h5>Selected Objects to {{clipboard.action}}</h5>
            <a class="clear_clipboard" title="Clear clipboard" href="" (click)="$event.preventDefault();clearClipboard()">
                Clear <span class="glyphicon glyphicon-remove"></span>
            </a>
            <div class="table_block">
                <div class="header">
                    <div *ngIf="clipboard.action === 'merge' || clipboard.hasPatient === true">
                        Patient ID
                    </div>
                    <div class="study_block" [ngClass]="{'haspatient':clipboard.hasPatient === true}" *ngIf="clipboard.action != 'merge'">Study Instance UID
                        <div *ngIf="showClipboardHeaders.series || showClipboardHeaders.instance">Series Instance UID
                            <div *ngIf="showClipboardHeaders.instance">
                                <span class="sopclass">Referenced SOP Class UID</span>
                                <span class="sopinstance">Referenced SOP Instance UID</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="body">
                    <ng-container *ngIf="clipboard.action === 'merge'">
                        <div class="block" *ngFor="let value of clipboard.patients">
                            {{ value.PatientID }}
                            <i (click)='removeClipboardElement("patient",{"patientkey":value})' class="remove glyphicon glyphicon-remove"></i>
                        </div>
                    </ng-container>
                    <ng-container *ngIf="clipboard.action != 'merge'">
                        <div class="block" *ngFor="let value of getKeys(clipboard.otherObjects)">
                            <div *ngIf="!clipboard.otherObjects[value].StudyInstanceUID" class="patient_block block_part">
                                {{value}}
                                <i (click)='removeClipboardElement("patient",{"patientkey":value})' class="remove glyphicon glyphicon-remove"></i>
                            </div>
                            <div *ngIf="clipboard.otherObjects[value].StudyInstanceUID" class="study_block block_part" [ngClass]="{'haspatient':clipboard.hasPatient === true}">
                                {{clipboard.otherObjects[value].StudyInstanceUID}}
                                <i (click)='removeClipboardElement("study",{"studykey":value})' class="remove glyphicon glyphicon-remove"></i>
                                <ng-container *ngIf="clipboard.otherObjects[value] && clipboard.otherObjects[value].ReferencedSeriesSequence">
                                    <div class="series_block block_part" *ngFor="let seriesequence of getKeys(clipboard.otherObjects[value].ReferencedSeriesSequence); let key = index;" [ngClass]="{'no-series':(!seriesequence || !(seriesequence && seriesequence.ReferencedSOPSequence)),'series':(seriesequence && seriesequence.ReferencedSOPSequence),'scroll-active':clipboardHasScrollbar}">
                                        <ng-container *ngIf="seriesequence && seriesequence.SeriesInstanceUID">
                                            {{seriesequence.SeriesInstanceUID}}
                                        </ng-container>
                                        <i *ngIf="seriesequence && seriesequence.SeriesInstanceUID" (click)='removeClipboardElement("serie", {"studykey":value, "serieskey":key})' class="remove glyphicon glyphicon-remove"></i>
                                        <ng-container *ngIf="seriesequence && seriesequence.ReferencedSOPSequence">
                                            <div class="sop_block block_part" *ngFor="let sopseq of getKeys(seriesequence.ReferencedSOPSequence); let key2 = index;">
                                                <span class="sopclass">
                                                    {{sopseq.ReferencedSOPClassUID}}
                                                </span>
                                                <span class="sopinstance">
                                                    {{sopseq.ReferencedSOPInstanceUID}}
                                                </span>
                                                <i (click)='removeClipboardElement("instance", {"studykey":value, "serieskey":key, "instancekey":key2})' class="remove glyphicon glyphicon-remove"></i>
                                            </div>
                                        </ng-container>
                                    </div>
                                </ng-container>
                            </div>
                        </div>
                    </ng-container>
                </div>
            </div>
        </div>
    </div>
    <div class="headerblock" [ngClass]="{modality:showModalitySelector}" (keydown)="keyDownOnHeader($event)">
        <div class="row filter visible_filters">
            <div class="main_filter_block">
                <div class="col-md-3 block-1-1">
                    <div class="row group_input">
                        <div class=" col-md-6">
                            <mat-select [(ngModel)]="externalInternalAetMode" (ngModelChange)="aetModeChange($event)">
                                <mat-option value="internal" title="Internal AET mode">Internal AET:</mat-option>
                                <mat-option value="external" title="External AET mode">External AET:</mat-option>
                            </mat-select>
                        </div>
                        <div class=" col-md-6">
                            <mat-select *ngIf="externalInternalAetMode === 'internal'" [(ngModel)]="aetmodel" (ngModelChange)="onChange($event, 'aetmodel')">
                                <mat-option *ngFor="let ae of aes" [value]="ae" title="{{ae.dicomDescription}}">{{ ae.dicomAETitle }}</mat-option>
                            </mat-select>
                            <mat-select *ngIf="externalInternalAetMode === 'external'" [(ngModel)]="externalInternalAetModel" (ngModelChange)="onChange($event, 'externalInternalAetModel')">
                                <mat-option *ngFor="let ae of allAes" [value]="ae" title="{{ae.dicomDescription}}">{{ ae.dicomAETitle }}</mat-option>
                            </mat-select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <input id="PatientName" type="text" [(ngModel)]="filter.PatientName" placeholder="Patient name" title="Patient name" class="col-md-12" />
                        </div>
                        <div class="col-md-6">
                            <label>
                                <input type="checkbox" [(ngModel)]="filter.fuzzymatching"> Fuzzy Matching
                            </label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <input id="PatientID" type="text" [(ngModel)]="filter.PatientID" placeholder="Patient ID" title="Patient ID" class="col-md-12" />
                        </div>
                        <div class="col-md-6">
                            <input autocomplete="off" id="IssuerOfPatientID" [disabled]="disabled.IssuerOfPatientID" type="text" [(ngModel)]="filter.IssuerOfPatientID" placeholder="Issuer of patient" title="Issuer of patient" class="col-md-12" (click)="conditionWarning($event, !filter.PatientID, 'Patient ID is empty, set first the patient ID!')" (keyup)="conditionWarning($event, !filter.PatientID, 'Patient ID is empty, set first the patient ID!')" />
                        </div>
                    </div>
                </div>
                <div class="col-md-3 block-1-1">
                    <div class="row" *ngIf="filterMode === 'mwl' || filterMode === 'study' || filterMode === 'diff'">
                        <div class="col-md-6">
                            <input id="AccessionNumber" type="text" [(ngModel)]="filter.AccessionNumber" placeholder="Accession number" title="Accession number" class="col-md-12" />
                        </div>
                        <div class="col-md-6">
                            <input id="LocalNamespaceEntityID" type="text" [disabled]="disabled.LocalNamespaceEntityID" [(ngModel)]="filter['IssuerOfAccessionNumberSequence.LocalNamespaceEntityID']" placeholder="Issuer of accession number" title="Issuer of accession number" class="col-md-12"  (keyup)="conditionWarning($event, !filter.AccessionNumber, 'Accession Number is empty, set first the Accession Number!')" (click)="conditionWarning($event, !filter.AccessionNumber, 'Accession Number is empty, set first the Accession Number!')"/>
                        </div>
                    </div>
                    <div class="row" *ngIf="filterMode === 'mwl'||filterMode === 'study' || filterMode === 'diff'">
                        <div class="col-md-6" *ngIf="filterMode === 'mwl'" >
                            <input id="ScheduledStationAETitle" type="text" [(ngModel)]="filter['ScheduledProcedureStepSequence.ScheduledStationAETitle']" placeholder="Scheduled Station AE Title" title="Scheduled Station AE Title" class="col-md-12 clearable" />
                        </div>
                        <div class="col-md-6" *ngIf="filterMode === 'study' || filterMode === 'diff'">
                            <input id="ReferringPhysicianName" type="text" [(ngModel)]="filter.ReferringPhysicianName" placeholder="Referring physician name" title="Referring physician name" class="col-md-12" />
                        </div>
                        <div class="col-md-6" *ngIf="filterMode === 'study' || filterMode === 'diff' || filterMode === 'mwl'" (clickOutside)='showModalitySelector = false'>
                            <input *ngIf="filterMode === 'mwl'" type="text" size="5"  [(ngModel)]="filter['ScheduledProcedureStepSequence.Modality']" (click)="showModalitySelector = !showModalitySelector" placeholder="Modality"  class="col-md-12" ng-keypress="checkKeyModality($event)"/>
                            <input *ngIf="filterMode === 'study' || filterMode === 'diff'" type="text" size="5"  [(ngModel)]="filter.ModalitiesInStudy" (click)="showModalitySelector = !showModalitySelector" placeholder="Modality"  class="col-md-12" ng-keypress="checkKeyModality($event)"/>
                            <div class="modality_selector [hidden]" *ngIf="showModalitySelector">
                                <a href="" (click)="showModalitySelector=false" class="close"><i class="glyphicon glyphicon-remove"></i></a>
                                <div class="common">
                                    <a href="" *ngFor="let value of modalities.common | getKey;" (click)="$event.preventDefault();selectModality(value._KEY)" title="{{value._VALUE}}">{{value._KEY}}</a>
                                </div>
                                <button (click)="filter.ModalitiesInStudy='';filter.ScheduledProcedureStepSequence.Modality='';showModalitySelector=false;" class="clear custom_button">Clear</button>
                                <!-- <div class="col-md-12"></div> -->
                                <a href="" (click)="$event.preventDefault();showMore=true" *ngIf="!showMore" class="more">more<i class="glyphicon glyphicon-triangle-bottom"></i></a>
                                <a href="" (click)="$event.preventDefault();showMore=false" *ngIf="showMore" class="more">less<i class="glyphicon glyphicon-triangle-top"></i></a>
                                <div class="more_block" *ngIf="showMore">
                                    <a href="" *ngFor="let value of modalities.more | getKey;" (click)="$event.preventDefault();selectModality(value._KEY)" title="{{value._VALUE}}">{{value._KEY}}</a>
                                    <div class="form-group">
                                        <label>Custom modality code:</label>
                                        <input *ngIf="filterMode === 'mwl'" [(ngModel)]="filter['ScheduledProcedureStepSequence.Modality']" />
                                        <input *ngIf="filterMode === 'study' || filterMode === 'diff'" [(ngModel)]="filter.ModalitiesInStudy" />
                                        <button (click)="showModalitySelector=false" class="custom_button">Add</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <input id="StudyInstanceUID" type="text" [(ngModel)]="filter.StudyInstanceUID" placeholder="Study Instance UID" title="study._VALUE instance UID" class="col-md-12 clearable" />
                        </div>
                        <div class="col-md-6">
                            <input  id="limit" type="number" min="1" [(ngModel)]="limit" class="col-md-12" title="Page Size" required/>
                        </div>
                    </div>

                </div>
                <div class="col-md-3 block-1-2" *ngIf="filterMode === 'mwl'">
                    <div class="row">
                        <label class="col-md-12">Scheduled Procedure Step Start Date / Time:</label>
                    </div>
                    <div class="row datetime">
                        <!--<div class="block_seid">-->
                            <div class="col-md-6">
                                <range-picker [model]="filter['ScheduledProcedureStepSequence.ScheduledProcedureStepStartDate']" (modelChange)="filter['ScheduledProcedureStepSequence.ScheduledProcedureStepStartDate']= $event" mode="range" placeholder="Scheduled Procedure Step Start Date" title="Scheduled Procedure Step Start Date" dateFormat="yymmdd" onlyDate="true" ></range-picker>

                                <!--<p-calendar dataType="string" [(ngModel)]="studyDate.from" dateFormat="yymmdd" monthNavigator="true" yearNavigator="true" yearRange="1800:2100" placeholder="Start date from"></p-calendar>-->
                            </div>
                            <div class="col-md-6">
                                <range-picker [model]="filter['ScheduledProcedureStepSequence.ScheduledProcedureStepStartTime']" (modelChange)="filter['ScheduledProcedureStepSequence.ScheduledProcedureStepStartTime'] = $event" mode="range" placeholder="Scheduled Procedure Step Start Time" title="Scheduled Procedure Step Start Date" dateFormat="yymmdd" onlyTime="true"></range-picker>

                                <!--<p-calendar (onSelect)="selectTime('from')" (onBlur)="selectTime('from')" (click)="timeClose()" [(ngModel)]="studyTime.fromObject" timeOnly="true" hourFormat="24" placeholder="Start time from"></p-calendar>-->
                            </div>
                        <!--</div>-->
<!--                        <div class="minus text-center">
                            -
                        </div>-->
                        <!--<div class="block_seid">-->
                            <div class="col-md-6">
                                <!--<p-calendar dataType="string" [(ngModel)]="studyDate.to" dateFormat="yymmdd" monthNavigator="true" yearNavigator="true" yearRange="1800:2100" placeholder="Start date to"></p-calendar>-->
                            </div>
                            <div class="col-md-6">
                                <!--<p-calendar (onSelect)="selectTime('to')" [(ngModel)]="studyTime.toObject" timeOnly="true" hourFormat="24" placeholder="Start time to"></p-calendar>-->
                            </div>
                        <!--</div>-->
                    </div>
                </div>
                <div class="col-md-3 block-1-2" *ngIf="filterMode === 'study' || filterMode === 'diff'">
    <!--                <div class="row">
                        <label class="col-md-12">Study Date / Time:</label>
                    </div>-->
                    <div class="row datetime">
                        <div class="block_seid">
                            <div class="col-md-12">
                                <range-picker *ngIf="externalInternalAetMode === 'internal' && filterMode != 'diff'" [model]="filter.StudyDate" (modelChange)="filter.StudyDate = $event" mode="range" placeholder="Study date" dateFormat="yymmdd" onlyDate="true" title="Study date"></range-picker>
                                <range-picker *ngIf="externalInternalAetMode === 'external' || filterMode === 'diff'" [model]="filter.StudyDate" (modelChange)="filter.StudyDate = $event" mode="range" placeholder="Study date" dateFormat="yymmdd" onlyDate="true" title="Study date" dateRange="true" (splitDateRangeChanged)="filter.SplitStudyDateRange = $event"></range-picker>
                            </div>
                            <div class="col-md-12">
                                <range-picker [model]="filter.StudyTime" (modelChange)="filter.StudyTime = $event" mode="range" placeholder="Study time" dateFormat="yymmdd" onlyTime="true" title="Study time"></range-picker>
                            </div>
                            <div class="col-md-12">
                                <input id="InstitutionalDepartmentName" type="text" [(ngModel)]="filter.InstitutionalDepartmentName" placeholder="Institutional Department Name" title="Institutional Department Name" class="col-md-12 clearable" />
                            </div>

                            </div>
<!--                        <div class="minus text-center">
                            -
                        </div>-->
                        <div class="block_seid">
                            <div class="col-md-12">
                                <!--<p-calendar (change)="studyDateChanged($event)" (click)="studyDateChanged($event)" dataType="string" [(ngModel)]="studyDate.to" dateFormat="yymmdd" monthNavigator="true" yearNavigator="true" yearRange="1800:2100" placeholder="Study date to"></p-calendar>-->
                                <!--<input id="StudyInstanceUID" type="text" [(ngModel)]="filter.StudyInstanceUID" placeholder="Study Instance UID" title="study._VALUE instance UID" class="col-md-12 clearable" />-->

                                <range-picker [model]="filter.StudyAccessDateTime" (modelChange)="filter.StudyAccessDateTime = $event" mode="range" placeholder="Study Access" title="Study Access Date Time" dateFormat="yymmdd"></range-picker>

                            </div>
                            <div class="col-md-12" *ngIf="filterMode === 'study' || filterMode === 'diff'">
                                <!--<p-calendar (onSelect)="selectTime('to')" [(ngModel)]="studyTime.toObject" timeOnly="true" hourFormat="24" placeholder="Study time to"></p-calendar>-->
                                <range-picker [model]="filter.StudyReceiveDateTime" (modelChange)="filter.StudyReceiveDateTime = $event" mode="range" placeholder="Study created" title="Study created" dateFormat="yymmdd"></range-picker>

                            </div>
                        </div>
                        <div class="block_seid">
                            <div class="col-md-12" *ngIf="filterMode === 'study' || filterMode === 'diff'">
                                <!--<p-calendar (change)="studyDateChanged($event)" (click)="studyDateChanged($event)" dataType="string" [(ngModel)]="studyDate.to" dateFormat="yymmdd" monthNavigator="true" yearNavigator="true" yearRange="1800:2100" placeholder="Study date to"></p-calendar>-->
                                <!--<input id="StudyInstanceUID" type="text" [(ngModel)]="filter.StudyInstanceUID" placeholder="Study Instance UID" title="study._VALUE instance UID" class="col-md-12 clearable" />-->
                                <input id="SendingApplicationEntityTitleOfSeries" type="text" [(ngModel)]="filter.SendingApplicationEntityTitleOfSeries" placeholder="Sending Application Entity Title of Series" title="Sending Application Entity Title of Series" class="col-md-12 clearable" />
                            </div>
                            <div class="col-md-12" *ngIf="filterMode === 'study' || filterMode === 'diff'">
                                <!--<p-calendar (onSelect)="selectTime('to')" [(ngModel)]="studyTime.toObject" timeOnly="true" hourFormat="24" placeholder="Study time to"></p-calendar>-->
                                <!--<range-picker [model]="filter.StudyReceiveDateTime" (modelChange)="filter.StudyReceiveDateTime = $event" mode="range" placeholder="Study created" dateFormat="yymmdd"></range-picker>-->
                            </div>
                        </div>
                    </div>
                </div>
                <a class="clearform_button" title="Clear all filters" href="" (click)="$event.preventDefault();clearForm()">
                    Clear <span class="glyphicon glyphicon-remove"></span>
                </a>
            </div>
            <div class="buttons_block col-md-2">
                <ng-container *ngIf="!(filterMode === 'diff' && diffModeShow)">
                    <div class="row col-md-12" title="AE Title of first C-FIND SCP" *ngIf="filterMode === 'diff'">
                        <mat-select [(ngModel)]="aet1" placeholder="Primary AET" floatPlaceholder="never">
                            <mat-option *ngFor="let ae of allAes" [value]="ae.dicomAETitle" title="Aet from the device {{ae.dicomDeviceName}}">{{ ae.dicomAETitle }}</mat-option>
                        </mat-select>
                    </div>
                    <i title="Switch the primary and secondary AET" (click)="swapDiff()" *ngIf="filterMode === 'diff'"  class="swap_icon material-icons">swap_vert</i>
                    <div class="row col-md-12" title="AE Title of second C-FIND SCP" *ngIf="filterMode === 'diff'">
                        <mat-select [(ngModel)]="aet2" placeholder="Secondary AET" floatPlaceholder="never">
                            <mat-option *ngFor="let ae of allAes" [value]="ae.dicomAETitle" title="Aet from the device {{ae.dicomDeviceName}}">{{ ae.dicomAETitle }}</mat-option>
                        </mat-select>
                    </div>
                    <div class="row col-md-12 diff_input diff_toggle_button" *ngIf="filterMode === 'diff'" (click)="diffFilter = !diffFilter">
                        <span class="click_outside_ignore">Diff Options <i *ngIf="!diffFilter" class="glyphicon glyphicon-triangle-bottom"></i><i *ngIf="diffFilter" class="glyphicon glyphicon-triangle-top"></i></span>
                    </div>
                    <div class="toggle_diff" *ngIf="diffFilter" (clickOutside)="diffFilter = false" [clickOutsideExceptionClass]="['diff_toggle_button', 'click_outside_ignore']">
                        <div class="row col-md-12 diff_input" *ngIf="filterMode === 'diff'">
                            <input type="checkbox" [(ngModel)]="diffQueue" placeholder="Queue" title="Queued diff" class="clearable" /> Queued
                        </div>
                        <div class="row col-md-12 diff_input" *ngIf="filterMode === 'diff' && diffQueue">
                            <input type="text" [(ngModel)]="batchID" title="Batch ID" class="clearable" placeholder="Batch ID"/>
                        </div>
                        <div class="row col-md-12 diff_input" *ngIf="filterMode === 'diff'">
                            <input type="checkbox" [(ngModel)]="missing" title="Include Studies different at Secondary AET" class="clearable" /> Missing Studies
                        </div>
                        <div class="row col-md-12 diff_input" *ngIf="filterMode === 'diff'">
                            <input type="checkbox" [(ngModel)]="different" title="Include Studies missing at Secondary AET" class="clearable" /> Different Studies
                        </div>
                        <mat-select *ngIf="different" [(ngModel)]="comparefield" placeholder="Attribute Set" floatPlaceholder="never">
                            <mat-option value="">*</mat-option>
                            <mat-option *ngFor="let attr of diffAttributeSet" [value]="attr.id" title="{{attr.description}}" >{{ attr.title }}</mat-option>
                        </mat-select>

                    </div>
                    <div class="count_block_total" *ngIf="filterMode==='study' && externalInternalAetMode === 'internal'" [permission]="{id:'action-studies-size',param:'visible'}">
                       <span class="count_text" title="Total size of filtered studies found">Size: <b class="nowrap">{{size|largeIntFormat}}</b></span>
                        <span *ngIf="!showGetSizeLoader" (click)="getSize()" title="Get total size of filtered studies" class="glyphicon glyphicon-refresh"></span>
                        <span *ngIf="showGetSizeLoader" class="fa fa-circle-o-notch fa-spin dashboard_loader"></span>
                    </div>
                    <div class="count_block_total" *ngIf="filterMode != 'diff'" [ngClass]="{single:externalInternalAetMode === 'external' || filterMode!='study'}" [permission]="{id:'action-studies-count',param:'visible'}">
                       <span class="count_text" title="Total count of filtered studies found">Total count: <b class="nowrap">{{count|largeIntFormat}}</b></span>
                            <span *ngIf="!showGetCountLoader" (click)="getCount()" title="Get total count of filtered studies" class="glyphicon glyphicon-refresh"></span>
                            <span *ngIf="showGetCountLoader" class="fa fa-circle-o-notch fa-spin"></span>
                    </div>
                    <div class="orderbyblock" [ngClass]="{notrash:trashaktive==false,diff:filterMode==='diff'}">
                        <div class="btn-group" role="group" (clickOutside)="showoptionlist = false">
                            <button id="showoptionlistbutton" type="button" class="btn btn-default selectedorderbutton" (click)="showoptionlist = !showoptionlist" >
                                <span id="selectedorder" class="selectedorder"  [innerHtml]="orderbytext"></span>
                                <span class="caret"></span>
                            </button>
                            <div class="optionlist" id="showoptionlist" *ngIf="showoptionlist && externalInternalAetMode === 'internal'" >
                                <ul>
                                    <li *ngFor="let order of orderby; let i = index;" [ngClass]="{active:filter.orderby === order.value}" (click)="orderByChanged(order)" title="{{order.title}}" [innerHtml]="order.label"></li>
                                </ul>
                            </div>
                            <div class="optionlist" id="showoptionlistExternal" *ngIf="showoptionlist && externalInternalAetMode === 'external'" >
                                <ul>
                                    <li *ngFor="let order of orderbyExternal; let i = index;" [ngClass]="{active:(filter.orderby === order.value && filterMode === order.mode)}" (click)="orderByChanged(order)" title="{{order.title}}" [innerHtml]="order.label"></li>
                                </ul>
                            </div>
                            <button type="button" class="btn btn-info btn-default executebutton" *ngIf="filterMode==='patient'" id="querypatients" (click)="queryPatients(0);patientmode=true" title="Query Patients">
                                <span class="glyphicon glyphicon-refresh"></span>
                            </button>
                            <button type="button" class="btn btn-default executebutton"
                                    *ngIf="filterMode==='study'" id="querystudies" (click)="queryStudies(0);patientmode=false" title="Query Studies">
                                <span class="glyphicon glyphicon-refresh"></span>
                            </button>
                            <button *ngIf="filterMode==='mwl'" type="button" class="btn btn-default executebutton btn-info"  id="querymwl" (click)="queryMWL(0);patientmode=false" title="Query MWL">
                                <span class="glyphicon glyphicon-refresh"></span>
                            </button>
                            <button *ngIf="filterMode==='diff'" type="button" class="btn btn-default executebutton btn-info"  id="querydiffs" (click)="queryDiffs(0);patientmode=false" title="Query Diff">
                                <span class="glyphicon glyphicon-refresh"></span>
                            </button>
                        </div>
                    </div>
                </ng-container>
                <ng-container *ngIf="filterMode === 'diff' && diffModeShow">
                    <div class="col-md-12 diff_mode_result_input" >
                        <input type="text" [(ngModel)]="taskPK" placeholder="Pk of task" title="Pk of task" class="col-md-12 clearable" (focus)="batchID = ''" />
                    </div>
                    <div class="col-md-12 diff_mode_result_input">
                        <input type="text" [(ngModel)]="batchID" placeholder="Bash ID" title="Bash ID" class="col-md-12 clearable" (focus)="taskPK = ''" />
                    </div>
                    <div class="col-md-12 diff_result_button">
                        <button type="button" class="col-md-12  btn btn-default btn-info"  (click)="getDiffTaskResults(0);" title="Query Diff Results">
                            <span class="glyphicon glyphicon-refresh"></span> Submit
                        </button>
                    </div>
                </ng-container>
                <div class="diff_mode_switch" *ngIf="filterMode==='diff'">
                    <ul>
                        <li (click)="diffModeShow = false" class="trigger" title="Trigger a new diff" [ngClass]="{active:!diffModeShow}">Trigger</li>
                        <li (click)="diffModeShow = true" class="show" title="Show diff results" [ngClass]="{active:diffModeShow}">Show</li>
                    </ul>
                </div>
            </div>
        </div>
        <!-- <div class="placeholder-35"></div> -->
        <div class="row filter hidden_filters" [hidden]="!advancedConfig">
            <div class="col-md-3 block-2-1">
                <div class="row">
                    <div class="col-md-6" *ngIf="filterMode === 'study' || filterMode === 'diff'">
                        <input id="InstitutionName" type="text" [(ngModel)]="filter.InstitutionName" placeholder="Institution Name" title="Institution Name" class="col-md-12" />
                    </div>
                    <div class="col-md-6" *ngIf="filterMode === 'study' || filterMode === 'diff'">
                        <!--<input id="SendingApplicationEntityTitleOfSeries" type="text" [(ngModel)]="filter.SendingApplicationEntityTitleOfSeries" placeholder="Sending Application Entity Title of Series" title="Sending Application Entity Title of Series" class="col-md-12 clearable" />-->
                    </div>
                    <div class="col-md-6" *ngIf="filterMode === 'study' || filterMode === 'diff'">
                        <!--<input id="InstitutionalDepartmentName" type="text" [(ngModel)]="filter.InstitutionalDepartmentName" placeholder="Institutional Department Name" title="Institutional Department Name" class="col-md-12 clearable" />-->
                    </div>
                    <div class="col-md-6" *ngIf="filterMode === 'study' || filterMode === 'diff'">
                        <input id="StationName" type="text" [(ngModel)]="filter.StationName" placeholder="Station Name" title="Station Name" class="col-md-12" />
                    </div>
                    <div class="col-md-6" *ngIf="filterMode === 'patient'">
                        <label title="Only patients with studies">
                            <input type="checkbox" [(ngModel)]="withoutstudies" (change)="filter.withoutstudies = !withoutstudies"> only with studies
                        </label>
                    </div>
                    <div class="col-md-6" *ngIf="filterMode === 'patient'">
                        <label>
                            Patient's Sex
                            <select
                                    (ngModelChange)="onChange($event, 'filter.PatientSex')"
                                    [ngModel]="filter.PatientSex">
                                <option [ngValue]="o.Value[0]" *ngFor="let o of options.genders">{{o.title}}</option>
                            </select>
                        </label>
                    </div>
                    <div class="col-md-6" *ngIf="filterMode === 'mwl'">
                        <input id="ScheduledProcedureStepStatus" type="text" [(ngModel)]="filter['ScheduledProcedureStepSequence.ScheduledProcedureStepStatus']" placeholder="SPS Status" title="Scheduled Procedure Step Status" class="col-md-12" />
                    </div>
                    <!--<div class="col-md-6" *ngIf="filterMode === 'mwl'">
                        <input id="ScheduledProcedureStepSequence" type="text" [(ngModel)]="filter['ScheduledProcedureStepSequence.ScheduledProcedureStepStartDate']" placeholder="SPS Description" title="Scheduled Procedure Step Description" class="col-md-12" />
                    </div>-->
                    <div class="col-md-6" *ngIf="filterMode === 'study' || filterMode === 'diff'">
                        <input id="SOPClassesInStudy" type="text" [(ngModel)]="filter.SOPClassesInStudy" placeholder="SOP classes in study" title="SOP classes in study" class="col-md-12 clearable" />
                    </div>
                    <div class="col-md-6" *ngIf="filterMode === 'study' || filterMode === 'diff'">
                        <input id="SeriesDescription" type="text" [(ngModel)]="filter.SeriesDescription" placeholder="Series Description" title="Series Description" class="col-md-12 clearable" />
                    </div>
                    <div class="col-md-6" *ngIf="filterMode === 'study' || filterMode === 'diff'">
                        <label title="Show only studies failed to be retrieved">
                            <input type="checkbox" [(ngModel)]="filter.storageVerificationFailed"> Storage Verification Failed
                        </label>
                    </div>
                    <div class="col-md-6">
                        <label title="Only Default">
                            <input type="checkbox" [(ngModel)]="filter.onlyDefault"> Only Default
                        </label>
                    </div>
                </div>
            </div>
            <div class="col-md-3 block-2-1">
                <div class="row">

                    <div class="col-md-6" *ngIf="filterMode === 'study' && externalInternalAetMode === 'internal'">
                        <label title="Compression Failed"  >
                            <input type="checkbox" [(ngModel)]="filter.compressionfailed"> Compression Failed
                        </label>
                    </div>
                    <div class="col-md-6" *ngIf="(filterMode === 'study' || filterMode === 'diff') && externalInternalAetMode === 'internal'">
                        <label title="Show only incomplete studies"  >
                            <input type="checkbox" [(ngModel)]="filter.incomplete"> Only incomplete studies
                        </label>
                    </div>
                    <div class="col-md-6" *ngIf="filterMode === 'study' || filterMode === 'diff'">
                        <input id="StudyID" type="text" [(ngModel)]="filter.StudyID" placeholder="StudyID" title="study._VALUE ID" class="col-md-12" />
                    </div>
                    <div class="col-md-6" *ngIf="filterMode === 'mwl'">
                        <input id="ScheduledPerformingPhysicianName" type="text" [(ngModel)]="filter['ScheduledProcedureStepSequence.ScheduledPerformingPhysicianName']" placeholder="Scheduled Performing Physician's Name" title="Scheduled Performing Physician's Name" class="col-md-12" />
                    </div>
                    <!--<div class="col-md-6" *ngIf="filterMode === 'study' || filterMode === 'diff' || filterMode === 'mwl'">-->
                        <!--<input id="StudyInstanceUID" type="text" [(ngModel)]="filter.StudyInstanceUID" placeholder="Study Instance UID" title="study._VALUE instance UID" class="col-md-12 clearable" />-->
                    <!--</div>-->
                    <div class="col-md-6" *ngIf="filterMode === 'study' || filterMode === 'diff'">
                        <input id="StudyDescription" type="text" [(ngModel)]="filter.StudyDescription" placeholder="Study Description" title="study._VALUE description" class="col-md-12" />
                    </div>
                    <div class="col-md-6" *ngIf="filterMode === 'study' || filterMode === 'diff'">
                        <!--<input id="BodyPartExamined" type="text" [(ngModel)]="filter.BodyPartExamined" placeholder="Body Part Examined" title="Body Part Examined" class="col-md-12 clearable" />-->
                    </div>
                    <div class="col-md-6" *ngIf="filterMode === 'patient'">
                        <p-calendar dataType="string" [(ngModel)]="filter.PatientBirthDate" dateFormat="yymmdd" monthNavigator="true" yearNavigator="true" yearRange="1800:2100" placeholder="Patient's Birth Date"></p-calendar>

                    </div>
                </div>
            </div>
            <div class="col-md-3 block-2-1" *ngIf="filterMode === 'study' || filterMode === 'diff'">
                <div class="row">
                    <div class="col-md-6" *ngIf="(filterMode === 'study' || filterMode === 'diff') && externalInternalAetMode === 'internal'">
                        <div class="input-group">
                            <span class="checkboxpart">
                                <input type="checkbox" [(ngModel)]="ExternalRetrieveAETchecked" (change)="filter.ExternalRetrieveAET = '';filter['ExternalRetrieveAET!'] = ''"> No
                            </span>
                            <input class="col-md-12 clearable inputpart" id="ExternalRetrieveAET" *ngIf="!ExternalRetrieveAETchecked" type="text" [(ngModel)]="filter.ExternalRetrieveAET" placeholder="External retrieve AET" title="Retrievable from external retrieve AET" />
                            <input class="col-md-12 clearable inputpart" id="ExternalRetrieveAET!" *ngIf="ExternalRetrieveAETchecked" type="text" [(ngModel)]="filter['ExternalRetrieveAET!']" placeholder="External retrieve AET" title="Not retrievable from external retrieve AET"/>
                        </div>
                    </div>
                    <div class="col-md-6" *ngIf="externalInternalAetMode === 'internal'">
                        <label title="Show only studies failed to be retrieved">
                            <input type="checkbox" [(ngModel)]="filter.retrievefailed"> Only failed to be retrieved
                        </label>
                    </div>
                </div>
                <div class="row" *ngIf="filterMode === 'study' || filterMode === 'diff'">
                    <div class="col-md-6">
                        <input id="BodyPartExamined" type="text" [(ngModel)]="filter.BodyPartExamined" placeholder="Body Part Examined" title="Body Part Examined" class="col-md-12 clearable" />
                    </div>
                    <div class="col-md-6" *ngIf="filterMode === 'diff'">
                        <input  type="checkbox" [(ngModel)]="filter.ForceQueryByStudyUID"> Force query by Study UID
                    </div>
                    <div class="col-md-6" *ngIf="externalInternalAetMode === 'internal' && filterMode != 'diff'">
                        <range-picker *ngIf="externalInternalAetMode === 'internal' && filterMode != 'diff'" [model]="filter.ExpirationDate" (modelChange)="filter.ExpirationDate = $event" mode="range" placeholder="Expiration Date" dateFormat="yymmdd" onlyDate="true" title="Expiration Date"></range-picker>
                    </div>

                </div>
            </div>
        </div>
        <div class="morefunctionblock">
            <a href="" (click)="extendedFilter(true, $event)" *ngIf="!advancedConfig" class="more">More filters<i class="glyphicon glyphicon-triangle-bottom"></i></a>
            <a href="" (click)="extendedFilter(false, $event)" *ngIf="advancedConfig" class="more [hidden]">Close more filters<i class="glyphicon glyphicon-triangle-top"></i></a>
            <div class="more functions" [permission]="{id:'action-studies-more_function',param:'visible'}" (clickOutside)="moreFunctionsButtons = false" [clickOutsideExceptionClass]="['mainbutton','mainbutton_more_icon','glyphicon']">
                <div class="mainbutton" (click)="moreFunctionsButtons = !moreFunctionsButtons" >
                   <span class="mainbutton_more_icon" *ngIf="!moreFunctionsButtons" >More functions<i class="glyphicon glyphicon-triangle-bottom"></i></span>
                    <span class="mainbutton_more_icon" *ngIf="moreFunctionsButtons">Close more functions<i class="glyphicon glyphicon-triangle-top"></i></span>
                </div>
                <ul *ngIf="moreFunctionsButtons">
                    <li (click)="moreFunctionsButtons = false;createPatient()" title="Create new patient">Create patient</li>
                    <li (click)="moreFunctionsButtons = false;uploadDicom()" *ngIf="externalInternalAetMode === 'internal'" title="Upload a DICOM Object">Upload DICOM Object</li>
                    <li (click)="moreFunctionsButtons = false;deleteRejectedInstances()" *ngIf="externalInternalAetMode === 'internal'" title="Delete Rejected Instances permanently">Permanent delete</li>
                    <li (click)="moreFunctionsButtons = false;retrieveMultipleStudies()" *ngIf="externalInternalAetMode === 'external'" title="Retrieve multiple studies">Retrieve multiple studies</li>
                    <li (click)="moreFunctionsButtons = false;exportMultipleStudies()" *ngIf="externalInternalAetMode === 'internal'" title="Retrieve multiple studies">Export multiple studies</li>
                    <li (click)="moreFunctionsButtons = false;storageVerification()"  title="Schedule Storage Verification of Studies">Storage Verification</li>
                    <li (click)="moreFunctionsButtons = false;downloadCSV()"  title="Download Studies as CSV">Download Studies as CSV</li>
                </ul>
            </div>
        </div>
        <div class="header_block" *ngIf="patients && patients.length != 0">
            <div class="thead header1" [ngClass]="{'hover':visibleHeaderIndex === 0}">
                <div class="tr_row">
                    <div class="th">
                    </div>
                    <div style="width:14%" class="th" >Patient Name
                        <a href="" class="order_arrow" (click)="$event.preventDefault();filter.orderby = 'PatientName';morePatients !== undefined ? queryPatients(0) : queryStudies(0)">
                            <span class="glyphicon glyphicon-triangle-top" aria-hidden="true"></span>
                        </a>
                        <a href="" class="order_arrow" (click)="$event.preventDefault();filter.orderby = '-PatientName';morePatients !== undefined ? queryPatients(0) : queryStudies(0)">
                            <span class="glyphicon glyphicon-triangle-bottom" aria-hidden="true"></span>
                        </a>
                    </div>
                    <div class="th" style="width:12%">
                        Patient ID
                    </div>
                    <div class="th" style="width:12%">
                        <!-- Referring Physician's Name -->
                        Issuer of patient
                    </div>
                    <div class="th" style="width:8%">
                        Birth Date (YYYYMMDD)
                    </div>
                    <div class="th" style="width:4%">
                        Sex
                    </div>
                    <div class="th" style="width:38%">
                        Patient Comments
                    </div>
                    <div class="th" style="width:2%" title="Number of Patient Related Studies">
                        #S
                    </div>
                </div>
            </div>
            <div class="thead header2" [ngClass]="{'hover':visibleHeaderIndex === 1}">
                <div class="tr_row">
                    <div class="th">

                    </div>
                    <div class="th">
                        Study ID
                    </div>
                    <div class="th"  style="width:16.6%">
                        Study Instance UID
                    </div>
                    <div class="th">Study Date
                        <a href="" class="order_arrow" (click)="$event.preventDefault();filter.orderby = 'StudyDate,StudyTime';queryStudies(0)">
                            <span class="glyphicon glyphicon-triangle-top" aria-hidden="true"></span>
                        </a>
                        <a href="" class="order_arrow" (click)="$event.preventDefault();filter.orderby = '-StudyDate,-StudyTime';queryStudies(0)">
                            <span class="glyphicon glyphicon-triangle-bottom" aria-hidden="true"></span>
                        </a>
                    </div>
                    <div style="width:5%" class="th">Study Time</div>
                    <div class="th" title="Referring Physician's Name">R. Physician's Name</div>
                    <div class="th">Accession Number</div>
                    <div style="width:5%" class="th">Modalities</div>
                    <div style="width:16.3%" class="th">Study Description</div>
                    <div style="width:3%" class="th">#S</div>
                    <div style="width:3%" class="th">#I</div>
                </div>
            </div>
            <div class="thead header3" [ngClass]="{'hover':visibleHeaderIndex === 2}">

                <div class="tr_row">
                    <div class="th">
                    </div>
                    <div class="th">Station Name</div>
                    <div class="th">Series Number</div>
                    <div class="th">PPS Start Date</div>
                    <div class="th">PPS Start Time</div>
                    <div class="th">Body Part</div>
                    <div class="th">Modality</div>
                    <div style="width:21%" class="th">Series Description</div>
                    <div style="width:2%" class="th">#I</div>
                </div>
            </div>
            <div class="thead header4" [ngClass]="{'hover':visibleHeaderIndex === 3}">
                <div class="tr_row ">
                    <div class="th" style="width:6.7%" >
                    </div>
                    <div class="th" style="width:18%" >SOP Class UID</div>
                    <div class="th">Instance Number</div>
                    <div class="th">Content Date</div>
                    <div class="th">Content Time</div>
                    <div style="width:30%" class="th">Content Description</div>
                    <div style="width:3%" class="th">#F</div>
                </div>
            </div>
            <div class="thead header5" [ngClass]="{'hover':visibleHeaderIndex === 4}">
                <div class="tr_row">
                    <div class="th">

                    </div>
                    <div class="th">
                        Requested Procedure ID
                    </div>
                    <div class="th"  style="width:16.6%">
                        Study Instance UID
                    </div>
                    <div class="th" title="Scheduled Procedure Step Start Date">SPS Start Date
                    </div>
                    <div style="width:5%" class="th" title="Scheduled Procedure Step Start Time">SPS Start Time</div>
                    <div class="th" title="Scheduled Performing Physician's Name">SP Physician's Name</div>
                    <div class="th">Accession Number</div>
                    <div style="width:5%" class="th">Modalities</div>
                    <div style="width:17.3%" class="th" title="Scheduled Procedure Step Description">SPS Description</div>
                    <div style="width:6%" class="th" title="Scheduled Station AE Title">SS AE Title</div>
                </div>
            </div>
            <div class="headerbuttons" *ngIf="filterMode != 'diff'" [permission]="{id:'action-studies-copy_merge_move',param:'visible'}">
                <button title="Toggle checkboxes for selection" class="activate_checkboxes" (click)="showCheckBoxes()"><i class="material-icons">playlist_add_check</i></button>
                <div class="movegroup">
                    <button *ngIf="externalInternalAetMode === 'internal'" [ngClass]="{'disabled':selected.hasPatient===true}" title="Copy selected studies/series/instances to clipboard" class="copyselected" (click)="ctrlC()"><i class="material-icons">content_copy</i></button>
                    <button *ngIf="externalInternalAetMode === 'internal'" [ngClass]="{'disabled':selected.hasPatient===true}" title="Cut selected studies/series/instances to clipboard" class="moveselected" (click)="ctrlX()"><i class="material-icons">content_cut</i></button>
                    <button title="Add for merge (Add selected patient in the clipboard for Merge)" class="moveselected" (click)="merge()"><i class="material-icons">supervisor_account</i></button>
                    <button title="Paste/merge studies/series/instances/patient that are in the clipboard to the selected object - open the copy/move/merge dialog" class="pasteselected" (click)="ctrlV()"><i class="material-icons">content_paste</i></button>
                </div>
            </div>
        </div>
    </div>
    <div id="tableblock" class="div-table animated" [ngClass]="{extended:(advancedConfig),modality:showModalitySelector}" contextmenu-container="meta.contextmenu">
        <div class="repeat0" contextmenu-item='patient._VALUE' *ngFor="let patient of patients | getKey">
            <div class="more_menu_content" *ngIf="filterMode != 'diff'">
                <div class="more_menu_study" [ngClass]="{show_checkboxes:showCheckboxes}">
                    <div class="colcell">
                        <div *ngIf="patientmode" class="table_btn" [innerHtml]="patient._VALUE.offset+1+'.' || ''"></div>
                    </div>
                      <div class="exeq_buttons">
                          <div class="morefunction" title="Show more functions" (click)="showMoreFunction($event,3)"></div>
                          <div class="checkbox_content hiddenbuttons" [permission]="{id:'action-studies-copy_merge_move',param:'visible'}">
                              <input type="checkbox" [ngModel]="patient._VALUE.selected" name="select" (change)='select(patient._VALUE,"patient",{"patientkey":patient._KEY},"fromcheckbox")'>
                          </div>
                          <a class="table_btn hiddenbuttons" [permission]="{id:'action-studies-patient',param:'edit'}" (click)="$event.preventDefault();editPatient(patient._VALUE, patient._KEY);" href="" title="Edit Patient">
                              <span class="glyphicon glyphicon-pencil"></span>
                          </a>
                          <a class="table_btn hiddenbuttons" *ngIf="externalInternalAetMode === 'internal'" [permission]="{id:'action-studies-patient',param:'upload'}" (click)="$event.preventDefault();patient._VALUE.createButtons = false;createMWL(patient._VALUE)" href="" title="Create MWL">
                              <span class="glyphicon glyphicon-plus" ></span>
                          </a>
                          <a class="table_btn hiddenbuttons" *ngIf="externalInternalAetMode === 'internal'" [permission]="{id:'action-studies-mwl',param:'create'}" (click)="$event.preventDefault();uploadInPatient(patient._VALUE)" href="" title="Upload file">
                              <i class="material-icons">file_upload</i>
                          </a>
                          <a class="table_btn hiddenbuttons"  *ngIf="externalInternalAetMode === 'internal' && ((_.hasIn(patient._VALUE,'attrs.00201200.Value[0]') && _.isEqual(patient._VALUE.attrs['00201200'].Value[0], 0) && aetmodel.dcmAllowDeletePatient != 'NEVER') || aetmodel.dcmAllowDeletePatient === 'ALWAYS')" (click)="$event.preventDefault();deletePatient(patient._VALUE, patients, patient._KEY)" href="" title="Delete Patient" [permission]="{id:'action-studies-patient',param:'delete'}">
                              <span class="glyphicon glyphicon-remove"></span>
                          </a>
                          <a class="table_btn hiddenbuttons"  *ngIf="externalInternalAetMode === 'internal' && aetmodel.dcmInvokeImageDisplayPatientURL"  (click)="$event.preventDefault();openViewer(patient._VALUE.attrs,'patient')" href="" title="Open patient in the viewer" [permission]="{id:'action-studies-viewer',param:'visible'}">
                              <span class="glyphicon glyphicon-eye-open"></span>
                          </a>
                          <a class="hiddenbuttons" *ngIf="externalInternalAetMode === 'internal'" (click)="$event.preventDefault();downloadCSV(patient._VALUE.attrs,'study')" href="" title="Download all patients studies as CSV">
                              <span class="custom_icon csv_icon_black"></span>
                          </a>
                      </div>
                  </div>
              </div>
              <div class="thead" [ngClass]="{hide:patient._VALUE.hide}" (click)='select(patient._VALUE,"patient",{"patientkey":patient._KEY},"click")'>
                  <div class="tr_row" [ngClass]="{selected: patient._VALUE.selected}">
                      <div class="th" style="width:10%" [ngClass]="{'xroad':(mainservice['xRoad'] || (mainservice.global['PDQs'] && mainservice.global['PDQs'].length > 0))}">
                          <!--<div *ngIf="patientmode" class="table_btn" [innerHtml]="patient._VALUE.offset+1+'.'"></div>-->
                          <a class="table_btn hiddenbuttons"  *ngIf="mainservice['xRoad'] || (mainservice.global['PDQs'] && mainservice.global['PDQs'].length > 0)"  (click)="$event.preventDefault();queryNationalPationtRegister(patient._VALUE)" href="" title="Query National Patient Registry">
                              <span class="xroad_icon"></span>
                          </a>
                          <a class="table_btn" (click)="$event.preventDefault();patient._VALUE.showAttributes = !patient._VALUE.showAttributes" href="" title="Show Attributes">
                              <span class="glyphicon glyphicon-th-list"></span>
                          </a>
                          <a *ngIf="!(patient._VALUE.studies || patient._VALUE.mwls) && filterMode != 'diff'" class="table_btn"  (click)="queryAllStudiesOfPatient(patient._VALUE,0, $event)" href="" title="Show Studies">&#9658;</a> <!--[hidden]="patient._VALUE.studies || patient._VALUE.mwls"-->
                          <a *ngIf="(patient._VALUE.studies) && filterMode != 'diff'" class="table_btn" (click)="$event.preventDefault();patients[patient._KEY].studies = null" href="" title="Hide Studies">&#9660;</a>

                          <a *ngIf="!patients[patient._KEY].showStudies && filterMode === 'diff'" class="table_btn"  (click)="$event.preventDefault();patients[patient._KEY].showStudies = true" href="" title="Show Studies">&#9658;</a> <!--[hidden]="patient._VALUE.studies || patient._VALUE.mwls"-->
                          <a *ngIf="patients[patient._KEY].showStudies && filterMode === 'diff'" class="table_btn" (click)="$event.preventDefault();patients[patient._KEY].showStudies = false" href="" title="Hide Studies">&#9660;</a>

                          <a class="table_btn" *ngIf="!patient._VALUE.showmwls && patient._VALUE.mwls" (click)="$event.preventDefault();patient._VALUE.showmwls = true" href="" title="Show MWLs">&#9658;</a>
                          <a class="table_btn" *ngIf="patient._VALUE.showmwls && patient._VALUE.mwls" (click)="$event.preventDefault();patient._VALUE.showmwls = false" href="" title="Hide MWLs">&#9660;</a>
                      </div>
                      <div style="width:14%" class="th txt hover_cell" ><div *ngIf="patient._VALUE.attrs['00100010'] && patient._VALUE.attrs['00100010'].Value && patient._VALUE.attrs['00100010'].Value[0]" tooltip="{{(patient._VALUE.attrs['00100010'].Value[0].Alphabetic) || '&nbsp;'}}" >{{(patient._VALUE.attrs['00100010'].Value[0].Alphabetic| trim:20) || '&nbsp;'}}</div></div>
                      <div style="width:12%" class="th txt hover_cell tsttrim" ><div *ngIf="patient._VALUE.attrs['00100020'] && patient._VALUE.attrs['00100020'].Value && patient._VALUE.attrs['00100020'].Value[0]" tooltip="{{(patient._VALUE.attrs['00100020'].Value[0]) || '&nbsp;'}}">{{(patient._VALUE.attrs['00100020'].Value[0]) || '&nbsp;'}}</div></div>
                      <div style="width:12%" class="th hover_cell" ><div *ngIf="patient._VALUE.attrs['00100021'] && patient._VALUE.attrs['00100021'].Value && patient._VALUE.attrs['00100021'].Value[0]" tooltip="{{(patient._VALUE.attrs['00100021'].Value[0])|| '&nbsp;'}}">{{(patient._VALUE.attrs['00100021'].Value[0]| trim:16) || '&nbsp;'}}</div></div>
                      <div style="width:8%"  class="th hover_cell" ><div *ngIf="patient._VALUE.attrs['00100030'] && patient._VALUE.attrs['00100030'].Value && patient._VALUE.attrs['00100030'].Value[0]">{{(patient._VALUE.attrs['00100030'].Value[0] | formatDA) || '&nbsp;'}}</div></div>
                      <div style="width:4%" class="th hover_cell" ><div *ngIf="patient._VALUE.attrs['00100040'] && patient._VALUE.attrs['00100040'].Value && patient._VALUE.attrs['00100040'].Value[0]"  [innerHtml]="(patient._VALUE.attrs['00100040'].Value[0]) || '&nbsp;'"></div></div>
                      <div style="width:38%" class="th txt hover_cell" ><div *ngIf="patient._VALUE.attrs['00104000'] && patient._VALUE.attrs['00104000'].Value && patient._VALUE.attrs['00104000'].Value[0]" tooltip="{{(patient._VALUE.attrs['00104000'].Value[0]) || '&nbsp;'}}">{{(patient._VALUE.attrs['00104000'].Value[0]| trim:80) || '&nbsp;'}}</div></div>
                      <div style="width:2%" class="th hover_cell"><div *ngIf="patient._VALUE.attrs['00201200'] && patient._VALUE.attrs['00201200'].Value && patient._VALUE.attrs['00201200'].Value[0]" >{{(patient._VALUE.attrs['00201200'].Value[0]) || '&nbsp;'}}</div></div>
                  </div>
              </div>
            <div class="tr_row"  *ngIf="patient._VALUE.showAttributes && patient._VALUE.attrs">
                <div class="td_cell attribute_list" id="{{patient._VALUE.attrs['00100020'].Value[0]}}">
                    <attribute-list *ngIf="patient._VALUE.attrs" [attrs]="patient._VALUE.attrs"></attribute-list>
                </div>
            </div>
            <div class="tr_row"  *ngIf="patient._VALUE.xroad">
                <div class="td_cell attribute_list">
                    <attribute-list [attrs]="patient._VALUE.xroad"></attribute-list>
                </div>
            </div>
            <ng-container *ngIf="patients[patient._KEY].showStudies || filterMode != 'diff'">
                <div class="repeat1" *ngFor="let study of patients[patient._KEY].studies | getKey" contextmenu-item="study">
                <div class="tbody">
                    <div class="tr_row">
                        <div class="more_menu_content" *ngIf="filterMode != 'diff'">
                            <div class="more_menu_study" [ngClass]="{show_checkboxes:showCheckboxes && externalInternalAetMode === 'internal'}">
                                <div class="colcell" [innerHtml]="study._VALUE.offset+1+'.'"></div>
                                <div class="exeq_buttons">
                                    <div class="morefunction" title="Show more functions" (click)="showMoreFunction($event, 5)"></div>
                                    <div *ngIf="externalInternalAetMode === 'internal'" class="checkbox_content hiddenbuttons" [permission]="{id:'action-studies-copy_merge_move',param:'visible'}">
                                        <input type="checkbox" [ngModel]="study._VALUE.selected" (change)='select(study._VALUE,"study", {"patientkey":patient._KEY,"studykey":study._KEY},"fromcheckbox")'>
                                    </div>
                                    <a  class="hiddenbuttons" *ngIf="externalInternalAetMode === 'internal'" (click)="$event.preventDefault();editStudy(patients[patient._KEY], patient._KEY, study._KEY, study._VALUE)" href="" title="Edit study" [permission]="{id:'action-studies-study',param:'edit'}">
                                        <span class="glyphicon glyphicon-pencil"></span>
                                    </a>
                                    <a class="hiddenbuttons" (click)="$event.preventDefault();exportStudy(study._VALUE)" [permission]="{id:'action-studies-study',param:'export'}" href="" title="Export study">
                                        <span class="glyphicon glyphicon-export"></span>
                                    </a>
                                    <a class="hiddenbuttons" (click)="$event.preventDefault();setExpiredDate(study._VALUE)" [permission]="{id:'action-studies-study',param:'edit'}" *ngIf="externalInternalAetMode === 'internal'" href="" title="Set/Change expired date">
                                        <i class="material-icons">history</i>
                                    </a>
                                    <a class="hiddenbuttons" (click)="$event.preventDefault();upload(study._VALUE,'study')" [permission]="{id:'action-studies-study',param:'upload'}" href="" title="Upload file">
                                        <i class="material-icons">file_upload</i>
                                    </a>
                                    <a class="hiddenbuttons" (click)="$event.preventDefault();storageCommitmen('study', study._VALUE)" *ngIf="externalInternalAetMode === 'internal'"  [permission]="{id:'action-studies-verify_storage_commitment',param:'visible'}" href="" title="Verify storage commitment">
                                        <span class="glyphicon glyphicon-ok"></span>
                                    </a>
                                    <a class="hiddenbuttons" *ngIf="(!trashaktive && _.hasIn(study._VALUE,'attrs.00201206.Value[0]') && !_.isEqual(study._VALUE.attrs['00201206'].Value[0], 0))" [permission]="{id:'action-studies-study',param:'reject'}" (click)="$event.preventDefault();rejectStudy(study._VALUE)" href="" title="Reject study">
                                        <span class="glyphicon glyphicon-trash"></span>
                                    </a>
                                    <a class="hiddenbuttons" *ngIf="(!trashaktive && _.hasIn(study._VALUE,'attrs.00201206.Value[0]') && !_.isEqual(study._VALUE.attrs['00201206'].Value[0], 0)) && externalInternalAetMode === 'internal'" [permission]="{id:'action-studies-download',param:'visible'}" (click)="$event.preventDefault();downloadZip(study._VALUE, 'study','uncompressed')" href="" title="Retrieve Study uncompressed">
                                        <span class="glyphicon glyphicon-save"></span>
                                    </a>
                                    <a class="hiddenbuttons" *ngIf="(!trashaktive && _.hasIn(study._VALUE,'attrs.00201206.Value[0]') && !_.isEqual(study._VALUE.attrs['00201206'].Value[0], 0)) && externalInternalAetMode === 'internal'" [permission]="{id:'action-studies-download',param:'visible'}" (click)="$event.preventDefault();;downloadZip(study._VALUE, 'study','compressed')" href="" title="Retrieve Study as stored at the archive">
                                        <span class="glyphicon glyphicon-download-alt"></span>
                                    </a>
                                    <a class="hiddenbuttons" *ngIf="(trashaktive || aetmodel.dcmAllowDeleteStudyPermanently === 'ALWAYS') && externalInternalAetMode === 'internal'" [permission]="{id:'action-studies-study',param:'delete'}" (click)="$event.preventDefault();deleteStudy(study._VALUE)" href="" title="Delete study permanently">
                                        <span class="glyphicon glyphicon-remove"></span>
                                    </a>
                                    <a class="hiddenbuttons"  *ngIf="trashaktive && externalInternalAetMode === 'internal'" [permission]="{id:'action-studies-study',param:'restore'}" (click)="$event.preventDefault();rejectStudy(study._VALUE)" href="" title="Restore study">
                                        <span class="glyphicon glyphicon-repeat"></span>
                                    </a>
                                    <a class="hiddenbuttons" *ngIf="aetmodel.dcmInvokeImageDisplayStudyURL && externalInternalAetMode === 'internal'" [permission]="{id:'action-studies-viewer',param:'visible'}" (click)="$event.preventDefault();openViewer(study._VALUE.attrs,'study')" href="" title="Open study in the viewer">
                                        <span class="glyphicon glyphicon-eye-open"></span>
                                    </a>
                                    <a class="hiddenbuttons" *ngIf="externalInternalAetMode === 'internal'" (click)="$event.preventDefault();downloadCSV(study._VALUE.attrs,'series')" href="" title="Download all series of study as CSV">
                                        <span class="custom_icon csv_icon_black"></span>
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div class="subblock">
                            <div class="td_row thead repeat1_hover" (click)='select(study._VALUE,"study", {"patientkey":patient._KEY,"studykey":study._KEY},"click")' [ngClass]="{selected: study._VALUE.selected, trash:trashaktive}">
                                <div class="td_cell table_btn">
                                    <a (click)="$event.preventDefault();study._VALUE.showAttributes = !study._VALUE.showAttributes" href="" title="Show Attributes">
                                        <span class="glyphicon glyphicon-th-list"></span>
                                    </a>
                                    <ng-container *ngIf="filterMode != 'diff'">
                                        <a *ngIf="!(study._VALUE.attrs['00201208'] && study._VALUE.attrs['00201208'].Value && study._VALUE.attrs['00201208'].Value[0] && study._VALUE.attrs['00201208'].Value[0] === 0) && !(study._VALUE.series)" (click)="$event.preventDefault();querySeries(study._VALUE,0)" href="" title="Show Series" [permission]="{id:'action-studies-serie',param:'visible'}">&#9658;</a>
                                        <a *ngIf="!(study._VALUE.attrs['00201208'] && study._VALUE.attrs['00201208'].Value && study._VALUE.attrs['00201208'].Value[0] && study._VALUE.attrs['00201208'].Value[0] === 0) && study._VALUE.series" (click)="$event.preventDefault();study._VALUE.series = null" href="" title="Hide Series" [permission]="{id:'action-studies-serie',param:'visible'}">&#9660;</a>
                                    </ng-container>
                                </div>
                                <ng-container *ngIf="filterMode != 'diff'">
                                    <div style="width:10.4%" class="td_cell txt hover_cell"><div tooltip="{{study._VALUE.attrs['00200010'].Value[0]}}" *ngIf="study._VALUE.attrs['00200010'] && study._VALUE.attrs['00200010'].Value && study._VALUE.attrs['00200010'].Value[0]">{{(study._VALUE.attrs['00200010'].Value[0]) || '&nbsp;'}}</div></div>
                                    <div  style="width:17.3%" class="td_cell txt hover_cell"><div *ngIf="study._VALUE.attrs['0020000D'] && study._VALUE.attrs['0020000D'].Value && study._VALUE.attrs['0020000D'].Value[0]" tooltip="{{study._VALUE.attrs['0020000D'].Value[0]}}">{{study._VALUE.attrs['0020000D'].Value[0] | trim:30}}</div></div>
                                    <div class="td_cell txt hover_cell" >
                                        <div *ngIf="study._VALUE.attrs['00080020'] && study._VALUE.attrs['00080020'].Value && study._VALUE.attrs['00080020'].Value[0]" tooltip="{{study._VALUE.attrs['00080020'].Value[0]}}">
                                            {{(study._VALUE.attrs['00080020'].Value[0] | formatDA) || '&nbsp;'}}
                                            <a *ngIf="study._VALUE.attrs['00080020'] && study._VALUE.attrs['00080020'].Value && study._VALUE.attrs['00080020'].Value[0]" href="" class="order_arrow" (click)="$event.preventDefault();filter.orderby = 'StudyDate,StudyTime';queryStudies(0)" title="Order study by Date (descending)">
                                                <span class="glyphicon glyphicon-triangle-top" aria-hidden="true" ></span>
                                            </a>
                                            <a *ngIf="study._VALUE.attrs['00080020'] && study._VALUE.attrs['00080020'].Value && study._VALUE.attrs['00080020'].Value[0]" href="" class="order_arrow" (click)="$event.preventDefault();filter.orderby = '-StudyDate,-StudyTime';queryStudies(0)" title="Order study by Date (ascending)">
                                                <span class="glyphicon glyphicon-triangle-bottom" aria-hidden="true"></span>
                                            </a>
                                        </div>
                                    </div>
                                    <div style="width:5.1%" class="td_cell hover_cell" ><div *ngIf="study._VALUE.attrs['00080030'] && study._VALUE.attrs['00080030'].Value && study._VALUE.attrs['00080030'].Value[0]" [innerHtml]="(study._VALUE.attrs['00080030'].Value[0] | formatTM) || '&nbsp;'"></div></div>
                                    <div style="width:10.2%" class="td_cell txt hover_cell"  >
                                        <div *ngIf="study._VALUE.attrs['00080090'] && study._VALUE.attrs['00080090'].Value && study._VALUE.attrs['00080090'].Value[0] && study._VALUE.attrs['00080090'].Value[0].Alphabetic" tooltip="{{study._VALUE.attrs['00080090'].Value[0].Alphabetic}}">{{(study._VALUE.attrs['00080090'].Value[0].Alphabetic|trim:18) || '&nbsp;'}}</div>
                                    </div>
                                    <div class="td_cell txt hover_cell" ><div *ngIf="study._VALUE.attrs['00080050'] && study._VALUE.attrs['00080050'].Value && study._VALUE.attrs['00080050'].Value[0]" tooltip="{{study._VALUE.attrs['00080050'].Value[0]}}"  >{{(study._VALUE.attrs['00080050'].Value[0]) || '&nbsp;'}}</div></div>
                                    <div style="width:5.2%" class="td_cell hover_cell">
                                        <div [innerHtml]="(study._VALUE.attrs['00080061'] | formatAttributeValue) || '&nbsp;'" *ngIf="study._VALUE.attrs['00080061'] && study._VALUE.attrs['00080061'].Value">&nbsp;</div>
                                    </div>
                                    <div style="width:17%" class="td_cell txt hover_cell" ><div tooltip="{{study._VALUE.attrs['00081030'].Value[0]}}" *ngIf="study._VALUE.attrs['00081030'] && study._VALUE.attrs['00081030'].Value && study._VALUE.attrs['00081030'].Value[0]">{{(study._VALUE.attrs['00081030'].Value[0] | trim:38) || '&nbsp;'}}</div></div>
                                    <div style="width:3%" class="td_cell txt hover_cell"  ><div *ngIf="study._VALUE.attrs['00201206'] && study._VALUE.attrs['00201206'].Value && study._VALUE.attrs['00201206'].Value[0]" tooltip="{{study._VALUE.attrs['00201206'].Value[0]}}">{{(study._VALUE.attrs['00201206'].Value[0]) || '&nbsp;'}}</div></div>
                                    <div style="width:3%" class="td_cell txt hover_cell" ><div *ngIf="study._VALUE.attrs['00201208'] && study._VALUE.attrs['00201208'].Value && study._VALUE.attrs['00201208'].Value[0]" tooltip="{{study._VALUE.attrs['00201208'].Value[0]}}">{{(study._VALUE.attrs['00201208'].Value[0]) || '&nbsp;'}}</div></div>
                                </ng-container>
                                <ng-container *ngIf="filterMode === 'diff'">
                                    <div style="width:10.4%" class="td_cell txt hover_cell" [ngClass]="{diff_border: study._VALUE.diffHeaders['00200010'].showBorder}">
                                        <div tooltip="{{study._VALUE.diffHeaders['00200010'].value}}" *ngIf="study._VALUE.attrs['00200010'] && study._VALUE.attrs['00200010'].Value && study._VALUE.attrs['00200010'].Value[0]">{{(study._VALUE.diffHeaders["00200010"].value| trim:18) || '&nbsp;'}}</div>
                                    </div>
                                    <div  style="width:17.3%" class="td_cell txt hover_cell" [ngClass]="{diff_border: study._VALUE.diffHeaders['0020000D'].showBorder}">
                                        <div *ngIf="study._VALUE.attrs['0020000D'] && study._VALUE.attrs['0020000D'].Value && study._VALUE.attrs['0020000D'].Value[0]" tooltip="{{study._VALUE.diffHeaders['0020000D'].value}}">{{study._VALUE.diffHeaders["0020000D"].value | trim:30}}</div>
                                    </div>
                                    <div class="td_cell txt hover_cell" [ngClass]="{diff_border: study._VALUE.diffHeaders['00080020'].showBorder}">
                                        <div *ngIf="study._VALUE.attrs['00080020'] && study._VALUE.attrs['00080020'].Value && study._VALUE.attrs['00080020'].Value[0]" tooltip="{{study._VALUE.diffHeaders['00080020'].value}}">
                                            {{(study._VALUE.diffHeaders['00080020'].value| trim:10) || '&nbsp;'}}
                                            <a *ngIf="study._VALUE.attrs['00080020'] && study._VALUE.attrs['00080020'].Value && study._VALUE.attrs['00080020'].Value[0]" href="" class="order_arrow" (click)="$event.preventDefault();filter.orderby = 'StudyDate,StudyTime';queryStudies(0)" title="Order study by Date (descending)">
                                                <span class="glyphicon glyphicon-triangle-top" aria-hidden="true" ></span>
                                            </a>
                                            <a *ngIf="study._VALUE.attrs['00080020'] && study._VALUE.attrs['00080020'].Value && study._VALUE.attrs['00080020'].Value[0]" href="" class="order_arrow" (click)="$event.preventDefault();filter.orderby = '-StudyDate,-StudyTime';queryStudies(0)" title="Order study by Date (ascending)">
                                                <span class="glyphicon glyphicon-triangle-bottom" aria-hidden="true"></span>
                                            </a>
                                        </div>
                                    </div>
                                    <div style="width:5.1%" class="td_cell hover_cell" [ngClass]="{diff_border: study._VALUE.diffHeaders['00080030'].showBorder}">
                                        <div *ngIf="study._VALUE.attrs['00080030'] && study._VALUE.attrs['00080030'].Value && study._VALUE.attrs['00080030'].Value[0]" [innerHtml]="(study._VALUE.diffHeaders['00080030'].value| trim:9) || '&nbsp;'"></div>
                                    </div>
                                    <div style="width:10.2%" class="td_cell txt hover_cell"  [ngClass]="{diff_border: study._VALUE.diffHeaders['00080090'].showBorder}">
                                        <div *ngIf="study._VALUE.attrs['00080090'] && study._VALUE.attrs['00080090'].Value && study._VALUE.attrs['00080090'].Value[0] && study._VALUE.attrs['00080090'].Value[0].Alphabetic" tooltip="{{study._VALUE.diffHeaders['00080090'].value}}">{{(study._VALUE.diffHeaders['00080090'].value|trim:18) || '&nbsp;'}}</div>
                                    </div>
                                    <div class="td_cell txt hover_cell" [ngClass]="{diff_border: study._VALUE.diffHeaders['00080050'].showBorder}"><div *ngIf="study._VALUE.attrs['00080050'] && study._VALUE.attrs['00080050'].Value && study._VALUE.attrs['00080050'].Value[0]" tooltip="{{study._VALUE.diffHeaders['00080050'].value}}"  >{{study._VALUE.diffHeaders['00080050'].value|| '&nbsp;'}}</div></div>
                                    <div style="width:5.2%" class="td_cell hover_cell" [ngClass]="{diff_border: study._VALUE.diffHeaders['00080061'].showBorder}">
                                        <div [innerHtml]="(study._VALUE.diffHeaders['00080061'].value| trim:9) || '&nbsp;'" tooltip="study._VALUE.diffHeaders['00080061'].value" *ngIf="study._VALUE.attrs['00080061'] && study._VALUE.attrs['00080061'].Value">&nbsp;</div>
                                    </div>
                                    <div style="width:17%" class="td_cell txt hover_cell" [ngClass]="{diff_border: study._VALUE.diffHeaders['00081030'].showBorder}"><div tooltip="{{study._VALUE.diffHeaders['00081030'].value}}" *ngIf="study._VALUE.attrs['00081030'] && study._VALUE.attrs['00081030'].Value && study._VALUE.attrs['00081030'].Value[0]">{{(study._VALUE.diffHeaders['00081030'].value | trim:38) || '&nbsp;'}}</div></div>
                                    <div style="width:3%" class="td_cell txt hover_cell"  [ngClass]="{diff_border: study._VALUE.diffHeaders['00201206'].showBorder}"><div *ngIf="study._VALUE.attrs['00201206'] && study._VALUE.attrs['00201206'].Value && study._VALUE.attrs['00201206'].Value[0]" tooltip="{{study._VALUE.diffHeaders['00201206'].value}}">{{(study._VALUE.diffHeaders['00201206'].value | trim:5) || '&nbsp;'}}</div></div>
                                    <div style="width:3%" class="td_cell txt hover_cell" [ngClass]="{diff_border: study._VALUE.diffHeaders['00201208'].showBorder}"><div *ngIf="study._VALUE.attrs['00201208'] && study._VALUE.attrs['00201208'].Value && study._VALUE.attrs['00201208'].Value[0]" tooltip="{{study._VALUE.diffHeaders['00201208'].value}}">{{(study._VALUE.diffHeaders['00201208'].value | trim:5) || '&nbsp;'}}</div></div>
                                </ng-container>
                            </div>
                            <div class="td_row">
                                <div class="tr_row"  *ngIf="study._VALUE.showAttributes">
                                    <div class="td_cell attribute_list" id="{{patient._VALUE.attrs['00100020'].Value[0] | removedots}}{{study._VALUE.attrs['0020000D'].Value[0] | removedots}}">
                                        <attribute-list *ngIf="study._VALUE.attrs" [attrs]="study._VALUE.attrs"></attribute-list>
                                    </div>
                                </div>
                                <div class="repeat2" *ngFor="let series of study._VALUE.series | getKey" contextmenu-item="series" >
                                    <div class="subblock">
                                        <div class="more_menu_content">
                                            <div class="more_menu_study" [ngClass]="{show_checkboxes:showCheckboxes && externalInternalAetMode === 'internal'}">
                                                <div class="td_cell colcell" [innerHtml]="series._VALUE.offset+1+'.'"></div>
                                                <div class="exeq_buttons" >
                                                    <div class="morefunction" title="Show more functions" (click)="showMoreFunction($event,6)"></div>
                                                    <div *ngIf="externalInternalAetMode === 'internal'" class="checkbox_content hiddenbuttons" [permission]="{id:'action-studies-copy_merge_move',param:'visible'}">
                                                        <input type="checkbox" [ngModel]="series._VALUE.selected" (change)='select(series._VALUE,"series", {"patientkey":patient._KEY,"studykey":study._KEY, "serieskey":series._KEY},"fromcheckbox")'>
                                                    </div>
                                                    <a class="hiddenbuttons" (click)="$event.preventDefault();exportSeries(series._VALUE)" [permission]="{id:'action-studies-serie',param:'export'}" href="" title="Export Series">
                                                        <span class="glyphicon glyphicon-export"></span>
                                                    </a>
                                                    <a class="hiddenbuttons" *ngIf="(!trashaktive && _.hasIn(series._VALUE,'attrs.00201208.Value[0]') && !_.isEqual(series._VALUE.attrs['00201208'].Value[0], 0))" (click)="$event.preventDefault();rejectSeries(series._VALUE)" href="" title="Reject Series" [permission]="{id:'action-studies-serie',param:'reject'}">
                                                        <span  class="glyphicon glyphicon-trash"></span>
                                                    </a>
                                                    <a class="hiddenbuttons" *ngIf="trashaktive && externalInternalAetMode === 'internal'" (click)="$event.preventDefault();rejectSeries(series._VALUE)" href="" title="Restore Series" [permission]="{id:'action-studies-serie',param:'restore'}">
                                                        <span class="glyphicon glyphicon-repeat"></span>
                                                    </a>
                                                    <a class="hiddenbuttons" (click)="$event.preventDefault();storageCommitmen('series', series._VALUE)" *ngIf="externalInternalAetMode === 'internal'" href="" title="Verify storage commitment" [permission]="{id:'action-studies-verify_storage_commitment',param:'visible'}">
                                                        <span class="glyphicon glyphicon-ok"></span>
                                                    </a>
                                                    <a class="hiddenbuttons" *ngIf="(!trashaktive && _.hasIn(study._VALUE,'attrs.00201206.Value[0]') && !_.isEqual(study._VALUE.attrs['00201206'].Value[0], 0)) && externalInternalAetMode === 'internal'" [permission]="{id:'action-studies-download',param:'visible'}" (click)="$event.preventDefault();downloadZip(series._VALUE, 'serie','uncompressed')" href="" title="Retrieve Serie uncompressed">
                                                        <span class="glyphicon glyphicon-save"></span>
                                                    </a>
                                                    <a class="hiddenbuttons" *ngIf="(!trashaktive && _.hasIn(study._VALUE,'attrs.00201206.Value[0]') && !_.isEqual(study._VALUE.attrs['00201206'].Value[0], 0)) && externalInternalAetMode === 'internal'" [permission]="{id:'action-studies-download',param:'visible'}" (click)="$event.preventDefault();;downloadZip(series._VALUE, 'serie','compressed')" href="" title="Retrieve Serie as stored at the archive">
                                                        <span class="glyphicon glyphicon-download-alt"></span>
                                                    </a>
                                                    <a class="hiddenbuttons" *ngIf="externalInternalAetMode === 'internal'" (click)="$event.preventDefault();downloadCSV(series._VALUE.attrs,'instance')" href="" title="Download all instances of series as CSV">
                                                        <span class="custom_icon csv_icon_black"></span>
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="tr_row repeat2_hover" (click)='select(series._VALUE,"series", {"patientkey":patient._KEY,"studykey":study._KEY, "serieskey":series._KEY},"click")' [ngClass]="{selected: series._VALUE.selected}">
                                            <div class="td_cell table_btn">
                                                <a (click)="$event.preventDefault();series._VALUE.showAttributes = !series._VALUE.showAttributes" href="" title="Show Attributes">
                                                    <span class="glyphicon glyphicon-th-list"></span>
                                                </a>

                                                <a *ngIf="!series._VALUE.instances" (click)="$event.preventDefault();queryInstances(series._VALUE,0)" href="" title="Show Instances">&#9658;</a>
                                                <a *ngIf="series._VALUE.instances" (click)="$event.preventDefault();series._VALUE.instances = null" href="" title="Hide Instances">&#9660;</a>
                                            </div>
                                            <div class="td_cell txt hover_cell"><div *ngIf="series._VALUE.attrs['00081010'] && series._VALUE.attrs['00081010'].Value && series._VALUE.attrs['00081010'].Value[0]" tooltip="{{series._VALUE.attrs['00081010'].Value[0]}}" >{{(series._VALUE.attrs['00081010'].Value[0]) || '&nbsp;'}}</div></div>
                                            <div class="td_cell txt hover_cell"><div *ngIf="series._VALUE.attrs['00200011'] && series._VALUE.attrs['00200011'].Value && series._VALUE.attrs['00200011'].Value[0]" tooltip="{{series._VALUE.attrs['00200011'].Value[0]}}" >{{(series._VALUE.attrs['00200011'].Value[0]|trim:20) || '&nbsp;'}}</div></div>
                                            <div class="td_cell txt hover_cell"><div *ngIf="series._VALUE.attrs['00400244'] && series._VALUE.attrs['00400244'].Value && series._VALUE.attrs['00400244'].Value[0]" tooltip="{{series._VALUE.attrs['00400244'].Value[0]}}" >{{(series._VALUE.attrs['00400244'].Value[0] | formatDA) || '&nbsp;'}}</div></div>
                                            <div class="td_cell txt hover_cell"><div *ngIf="series._VALUE.attrs['00400245'] && series._VALUE.attrs['00400245'].Value && series._VALUE.attrs['00400245'].Value[0]" tooltip="{{series._VALUE.attrs['00400245'].Value[0]}}" >{{(series._VALUE.attrs['00400245'].Value[0] | formatTM) || '&nbsp;'}}</div></div>
                                            <div class="td_cell txt hover_cell"><div *ngIf="series._VALUE.attrs['00180015'] && series._VALUE.attrs['00180015'].Value && series._VALUE.attrs['00180015'].Value[0]" tooltip="{{series._VALUE.attrs['00180015'].Value[0]}}" >{{(series._VALUE.attrs['00180015'].Value[0]) || '&nbsp;'}}</div></div>
                                            <div class="td_cell hover_cell"><div *ngIf="series._VALUE.attrs['00080060'] && series._VALUE.attrs['00080060'].Value && series._VALUE.attrs['00080060'].Value[0]" [innerHtml]="(series._VALUE.attrs['00080060'].Value[0]) || '&nbsp;'" ></div></div>
                                            <div style="width:21.5%" class="td_cell txt hover_cell" ><div *ngIf="series._VALUE.attrs['0008103E'] && series._VALUE.attrs['0008103E'].Value && series._VALUE.attrs['0008103E'].Value[0]" tooltip="{{(series._VALUE.attrs['0008103E'].Value[0]) || '&nbsp;'}}">{{(series._VALUE.attrs['0008103E'].Value[0] |trim:38) || '&nbsp;'}}</div></div>
                                            <div style="width:2.1%" class="td_cell txt hover_cell" ><div *ngIf="series._VALUE.attrs['00201209'] && series._VALUE.attrs['00201209'].Value && series._VALUE.attrs['00201209'].Value[0]">{{(series._VALUE.attrs['00201209'].Value[0]) || '&nbsp;'}}</div></div>
                                        </div>
                                        <div class="tr_row"  *ngIf="series._VALUE.showAttributes">
                                            <div class="td_cell attribute_list">
                                                <attribute-list *ngIf="series._VALUE.attrs" [attrs]="series._VALUE.attrs"></attribute-list>
                                            </div>
                                        </div>
                                        <div class="repeat3" *ngFor="let instance of series._VALUE.instances | getKey" contextmenu-item="instance">
                                            <div class="more_menu_content instance_level">
                                                <div class="more_menu_study repeat3block" [ngClass]="{show_checkboxes:showCheckboxes && externalInternalAetMode === 'internal'}">
                                                    <div class="td_cell colcell" [innerHtml]="instance._VALUE.offset+1+'.'"></div>
                                                    <div class="exeq_buttons">
                                                        <div class="morefunction" title="Show more functions" (click)="showMoreFunction($event,7)"></div>
                                                        <div *ngIf="externalInternalAetMode === 'internal'" class="checkbox_content hiddenbuttons" [permission]="{id:'action-studies-copy_merge_move',param:'visible'}">
                                                            <input type="checkbox" [ngModel]="instance._VALUE.selected" (change)='select(instance._VALUE,"instance", {"patientkey":patient._KEY,"studykey":study._KEY, "serieskey":series._KEY, "instancekey":instance._KEY},"fromcheckbox")'>
                                                        </div>
                                                        <a class="hiddenbuttons" (click)="$event.preventDefault();exportInstance(instance._VALUE)" [permission]="{id:'action-studies-instance',param:'export'}" href="" title="Export instance">
                                                            <span class="glyphicon glyphicon-export"></span>
                                                        </a>
                                                        <a class="hiddenbuttons" *ngIf="!trashaktive" (click)="$event.preventDefault();rejectInstance(instance._VALUE)" [permission]="{id:'action-studies-instance',param:'reject'}" href="" title="Reject instance">
                                                            <span  class="glyphicon glyphicon-trash"></span>
                                                        </a>
                                                        <a class="hiddenbuttons" *ngIf="trashaktive" (click)="$event.preventDefault();rejectInstance(instance._VALUE) && externalInternalAetMode === 'internal'" href="" title="Restore instance" [permission]="{id:'action-studies-instance',param:'restore'}">
                                                            <span class="glyphicon glyphicon-repeat"></span>
                                                        </a>
                                                        <a class="hiddenbuttons" (click)="$event.preventDefault();storageCommitmen('instance', instance._VALUE)" *ngIf="externalInternalAetMode === 'internal'" [permission]="{id:'action-studies-verify_storage_commitment',param:'visible'}" href="" title="Verify storage commitment">
                                                            <span class="glyphicon glyphicon-ok"></span>
                                                        </a>
                                                        <a class="hiddenbuttons" *ngIf="!instance._VALUE.video && externalInternalAetMode === 'internal'" [permission]="{id:'action-studies-download',param:'visible'}" (click)="$event.preventDefault();downloadURL(instance._VALUE)" title="Download Uncompressed DICOM Object">
                                                            <span class="glyphicon glyphicon-save"></span>
                                                        </a>
                                                        <a class="hiddenbuttons" (click)="$event.preventDefault();downloadURL(instance._VALUE, '*')" *ngIf="externalInternalAetMode === 'internal'" [permission]="{id:'action-studies-download',param:'visible'}" title="Download DICOM Object">
                                                            <span class="glyphicon glyphicon-download-alt"></span>
                                                        </a>
                                                        <a class="hiddenbuttons" *ngIf="externalInternalAetMode === 'internal'" (click)="$event.preventDefault();viewInstance(instance._VALUE)" href="#" [permission]="{id:'action-studies-download',param:'visible'}" title="View DICOM Object">
                                                            <span class="glyphicon glyphicon-picture"></span>
                                                        </a>
<!--                                                        <span class="selecta hiddenbuttons" *ngIf="instance._VALUE.views.length > 1 && externalInternalAetMode === 'internal'" title="View DICOM Object">
                                                            <span class="glyphicon glyphicon-picture" (click)="select_show = !select_show"></span>
                                                            <div *ngIf="select_show" class="select_block">
                                                                <a *ngFor="let value of instance._VALUE.views" (click)="$event.preventDefault();instance._VALUE.view=value;viewInstance(instance._VALUE)">{{value}}</a>
                                                            </div>
                                                        </span>-->
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="subblock">
                                                <div class="tr_row repeat3_hover" (click)='select(instance._VALUE,"instance", {"patientkey":patient._KEY,"studykey":study._KEY, "serieskey":series._KEY, "instancekey":instance._KEY}, "click")' [ngClass]="{selected: instance._VALUE.selected}" >
                                                    <div class="td_cell table_btn" style="width:4%">
                                                        <!-- <input type="checkbox" [(ngModel)]="instance._VALUE.selected" class="selectcheckboxes" /> -->
                                                        <a style="width:45%" (click)="$event.preventDefault();toggleAttributs(series._VALUE.instances[instance._KEY],'attributs')" href="" title="Show Attributes" [ngClass]="{active:instance._VALUE.showAttributes}">
                                                            <span class="glyphicon glyphicon-th-list"></span>
                                                        </a>
                                                        <a style="width:45%" (click)="$event.preventDefault();toggleAttributs(series._VALUE.instances[instance._KEY],'fileattributs')" *ngIf="externalInternalAetMode === 'internal'" href="" title="Show Attributes from file" [ngClass]="{active:instance._VALUE.showFileAttributes}">
                                                            <span class="glyphicon glyphicon-list"></span>
                                                        </a>

                                                    </div>
                                                    <div class="td_cell txt hover_cell" style="width:18.6%" ><div *ngIf="instance._VALUE.attrs['00080016'] && instance._VALUE.attrs['00080016'].Value && instance._VALUE.attrs['00080016'].Value[0]" tooltip="{{instance._VALUE.attrs['00080016'].Value[0]}}" >{{(instance._VALUE.attrs['00080016'].Value[0]) || '&nbsp;'}}</div></div>
                                                    <div class="td_cell txt hover_cell"  ><div *ngIf="instance._VALUE.attrs['00200013'] && instance._VALUE.attrs['00200013'].Value && instance._VALUE.attrs['00200013'].Value[0]" tooltip="{{instance._VALUE.attrs['00200013'].Value[0]}}" >{{(instance._VALUE.attrs['00200013'].Value[0]) || '&nbsp;'}}</div></div>
                                                    <div class="td_cell hover_cell" ><div *ngIf="(instance._VALUE.attrs['00080023'] && instance._VALUE.attrs['00080023'].Value && instance._VALUE.attrs['00080023'].Value[0]) || (instance._VALUE.attrs['00700082'] && instance._VALUE.attrs['00700082'].Value && instance._VALUE.attrs['00700082'].Value[0])">{{((instance._VALUE.attrs['00080023'] || instance._VALUE.attrs['00700082']).Value[0] | formatDA) || '&nbsp;'}}</div></div>
                                                    <div class="td_cell hover_cell" ><div *ngIf="(instance._VALUE.attrs['00080033'] && instance._VALUE.attrs['00080033'].Value && instance._VALUE.attrs['00080033'].Value[0]) || (instance._VALUE.attrs['00700083'] && instance._VALUE.attrs['00700083'].Value && instance._VALUE.attrs['00700083'].Value[0])">{{((instance._VALUE.attrs['00080033'] || instance._VALUE.attrs['00700083']).Value[0] | formatTM) || '&nbsp;'}}</div></div>
                                                    <div style="width:30.7%" class="td_cell txt hover_cell" tooltip="{{(instance._VALUE.attrs | contentDescription)}}" [innerHtml]="instance._VALUE.attrs | contentDescription"></div>
                                                    <div style="width:3%" class="td_cell hover_cell" >
                                                        <div *ngIf="instance._VALUE.attrs['00280008'] && instance._VALUE.attrs['00280008'].Value && instance._VALUE.attrs['00280008'].Value[0]" tooltip="{{instance._VALUE.attrs['00280008'].Value[0]}}" >{{instance._VALUE.attrs['00280008'].Value[0]|| '&nbsp;'}}</div>
                                                    </div>
                                                </div>
                                                <div class="tr_row"  *ngIf="instance._VALUE.showAttributes">
                                                    <div class="td_cell attribute_list">
                                                        <attribute-list [attrs]="instance._VALUE.attrs"></attribute-list>
                                                    </div>
                                                </div>
                                                <div class="tr_row"  *ngIf="instance._VALUE.showFileAttributes">
                                                    <div class="td_cell attribute_list file-attribute-list" id="file-attribute-list-{{instance._VALUE.attrs['00080018'].Value[0] | removedots}}">
                                                         <attribute-list  [studyuid]="instance._VALUE.wadoQueryParams.studyUID" [seriesuid]="instance._VALUE.wadoQueryParams.seriesUID" [objectuid]="instance._VALUE.wadoQueryParams.objectUID" [aet]="aet"></attribute-list>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="arrows" *ngIf="series._VALUE.instances && series._VALUE.instances.length">
                                        <div class="arrows_block">
                                            <button class="btn btn-link btn-xs"
                                                    [disabled]="series._VALUE.instances[0].offset==0"
                                                    (click)="queryInstances(series._VALUE, series._VALUE.instances[0].offset-limit)"
                                                    title="Previous Instances">
                                                <span class="glyphicon glyphicon-menu-left"></span>
                                            </button>
                                            <button class="btn btn-link btn-xs"
                                                    [disabled]="!series._VALUE.moreInstances"
                                                    (click)="queryInstances(series._VALUE, series._VALUE.instances[0].offset+limit)"
                                                    title="Next Instances">
                                                <span class="glyphicon glyphicon-menu-right"></span>
                                            </button>
                                        </div>
                                    </div>
                                </div><!--  -->
                            </div>
                            <div class="arrows" *ngIf="study._VALUE.series && study._VALUE.series.length">
                                    <!--length={{study._VALUE.series.length}}-->
                                <div class="arrows_block">
                                    <button class="btn btn-link btn-xs"
                                            [disabled]="study._VALUE.series[0].offset === 0"
                                            (click)="querySeries(study._VALUE, study._VALUE.series[0].offset-limit)"
                                            title="Previous Series">
                                        <span class="glyphicon glyphicon-menu-left"></span>
                                    </button>
                                    <button class="btn btn-link btn-xs"
                                            [disabled]="!study._VALUE.moreSeries"
                                            (click)="querySeries(study._VALUE, study._VALUE.series[0].offset+limit)"
                                            title="Next Series">
                                        <span class="glyphicon glyphicon-menu-right"></span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            </ng-container>
            <ng-container *ngIf="patient._VALUE.mwls && patient._VALUE.showmwls">
            <div class="repeat1" *ngFor="let mwl of patient._VALUE.mwls | getKey" >
                <div class="tbody">
                    <div class="tr_row">
                        <!--<div class="colcell" [innerHtml]="mwl._VALUE.offset+1+'.'"></div>-->
                        <div class="subblock">
                            <div class="td_row thead repeat4_hover" [ngClass]="{selected: mwl._VALUE.selected}" >
                                <div class="td_cell table_btn" style="width:7%">
                                    <div class="checkbox_content hiddenbuttons" [permission]="{id:'action-studies-copy_merge_move',param:'visible'}">
                                        <input type="checkbox" [ngModel]="mwl.selected" (change)='select(mwl._VALUE,"mwl", {"patientkey":patient._KEY,"studykey":study._KEY, "serieskey":series._KEY, "instancekey":instance._KEY},"fromcheckbox")'>
                                    </div>
                                    <a (click)="$event.preventDefault();mwl._VALUE.showAttributes = !mwl._VALUE.showAttributes" href="" title="Show Attributes">
                                        <span class="glyphicon glyphicon-th-list"></span>
                                    </a>
                                    <a [permission]="{id:'action-studies-mwl',param:'edit'}" (click)="$event.preventDefault();editMWL(patients[patient._KEY], patient._KEY, mwl._KEY, mwl._VALUE)" href="" title="Edit mwl">
                                        <span class="glyphicon glyphicon-pencil"></span>
                                    </a>
                                    <a [permission]="{id:'action-studies-mwl',param:'delete'}" (click)="$event.preventDefault();deleteMWL(mwl._VALUE)" href="" title="Delete mwl">
                                        <span class="glyphicon glyphicon-remove"></span>
                                    </a>
                                    <a (click)="$event.preventDefault();upload(mwl._VALUE,'mwl')" [permission]="{id:'action-studies-mwl',param:'upload'}" href="" title="Upload file">
                                        <i class="material-icons">file_upload</i>
                                    </a>
                                </div>
                                <div style="width:10.4%" class="td_cell txt hover_cell" ><div *ngIf="mwl._VALUE.attrs['00401001'] && mwl._VALUE.attrs['00401001'].Value && mwl._VALUE.attrs['00401001'].Value[0]" tooltip="{{mwl._VALUE.attrs['00401001'].Value[0]}}">{{(mwl._VALUE.attrs['00401001'].Value[0] | trim:19) || '&nbsp;' }}</div></div>
                                <div  style="width:17.3%"  class="td_cell txt hover_cell" ><div *ngIf="mwl._VALUE.attrs['0020000D'] && mwl._VALUE.attrs['0020000D'].Value && mwl._VALUE.attrs['0020000D'].Value[0]" tooltip="{{mwl._VALUE.attrs['0020000D'].Value[0]}}">{{(mwl._VALUE.attrs['0020000D'].Value[0] | trim:32) || '&nbsp;'}}</div></div>
                                <div class="td_cell txt hover_cell"  >
                                    <div *ngIf="mwl._VALUE.attrs['00400100'] && mwl._VALUE.attrs['00400100'].Value && mwl._VALUE.attrs['00400100'].Value[0] && mwl._VALUE.attrs['00400100'].Value[0]['00400002'] &&  mwl._VALUE.attrs['00400100'].Value[0]['00400002'].Value && mwl._VALUE.attrs['00400100'].Value[0]['00400002'].Value[0]" tooltip="{{mwl._VALUE.attrs['00400100'].Value[0]['00400002'].Value[0]}}">
                                        {{(mwl._VALUE.attrs['00400100'].Value[0]['00400002'].Value[0] | formatDA) || '&nbsp;'}}
                                    </div>
                                </div>
                                <div style="width:5.1%" class="td_cell hover_cell">
                                    <div *ngIf="mwl._VALUE.attrs['00400100'] && mwl._VALUE.attrs['00400100'].Value && mwl._VALUE.attrs['00400100'].Value[0] && mwl._VALUE.attrs['00400100'].Value[0]['00400003'] &&  mwl._VALUE.attrs['00400100'].Value[0]['00400003'].Value && mwl._VALUE.attrs['00400100'].Value[0]['00400003'].Value[0]">
                                        {{(mwl._VALUE.attrs['00400100'].Value[0]['00400003'].Value[0] | formatTM) || '&nbsp;'}}
                                    </div>
                                </div>
                                <div style="width:10.2%" class="td_cell txt hover_cell"  >
                                    <div  *ngIf="mwl._VALUE.attrs['00400100'] && mwl._VALUE.attrs['00400100'].Value && mwl._VALUE.attrs['00400100'].Value[0] && mwl._VALUE.attrs['00400100'].Value[0]['00400006'] &&  mwl._VALUE.attrs['00400100'].Value[0]['00400006'].Value && mwl._VALUE.attrs['00400100'].Value[0]['00400006'].Value[0] && mwl._VALUE.attrs['00400100'].Value[0]['00400006'].Value[0].Alphabetic" tooltip="{{mwl._VALUE.attrs['00400100'].Value[0]['00400006'].Value[0].Alphabetic}}">
                                        {{(mwl._VALUE.attrs['00400100'].Value[0]['00400006'].Value[0].Alphabetic) || '&nbsp;'}}
                                    </div>
                                </div>
                                <div class="td_cell txt hover_cell" >
                                    <div *ngIf="mwl._VALUE.attrs['00080050'] && mwl._VALUE.attrs['00080050'].Value && mwl._VALUE.attrs['00080050'].Value[0]" tooltip="{{mwl._VALUE.attrs['00080050'].Value[0]}}" >
                                        {{(mwl._VALUE.attrs['00080050'].Value[0]) || '&nbsp;'}}
                                    </div>
                                </div>
                                <div style="width:5.2%" class="td_cell hover_cell">
                                    <div *ngIf="mwl._VALUE.attrs['00400100'] && mwl._VALUE.attrs['00400100'].Value && mwl._VALUE.attrs['00400100'].Value[0] && mwl._VALUE.attrs['00400100'].Value[0]['00080060'] &&  mwl._VALUE.attrs['00400100'].Value[0]['00080060'].Value && mwl._VALUE.attrs['00400100'].Value[0]['00080060'].Value[0]">
                                        {{(mwl._VALUE.attrs['00400100'].Value[0]['00080060'].Value[0]) || '&nbsp;'}}
                                    </div>
                                </div>
                                <div style="width:18%" class="td_cell txt hover_cell" >
                                    <div  *ngIf="(mwl._VALUE.attrs['00400100'] && mwl._VALUE.attrs['00400100'].Value && mwl._VALUE.attrs['00400100'].Value[0] && mwl._VALUE.attrs['00400100'].Value[0]['00400007'] &&  mwl._VALUE.attrs['00400100'].Value[0]['00400007'].Value && mwl._VALUE.attrs['00400100'].Value[0]['00400007'].Value[0]) ||
                                                   (mwl._VALUE.attrs['00400100'] && mwl._VALUE.attrs['00400100'].Value && mwl._VALUE.attrs['00400100'].Value[0] && mwl._VALUE.attrs['00400100'].Value[0]['00400008'] &&  mwl._VALUE.attrs['00400100'].Value[0]['00400008'].Value && mwl._VALUE.attrs['00400100'].Value[0]['00400008'].Value[0] && mwl._VALUE.attrs['00400100'].Value[0]['00400008'].Value[0]['00080104'] && mwl._VALUE.attrs['00400100'].Value[0]['00400008'].Value[0]['00080104'].Value && mwl._VALUE.attrs['00400100'].Value[0]['00400008'].Value[0]['00080104'].Value[0])"
                                            tooltip="{{mwl._VALUE.attrs['00400100'].Value[0]['00400007'].Value[0] || mwl._VALUE.attrs['00400100'].Value[0]['00400008'].Value[0]['00080104'].Value[0]}}">

                                        {{(mwl._VALUE.attrs['00400100'].Value[0]['00400007'].Value[0]) || (mwl._VALUE.attrs['00400100'].Value[0]['00400008'].Value[0]['00080104'].Value[0]| trim:32) || '&nbsp;'}}
                                    </div>
                                </div>
                                <div style="width:6%" class="td_cell txt hover_cell" >
                                    <div *ngIf="mwl._VALUE.attrs['00400100'] && mwl._VALUE.attrs['00400100'].Value && mwl._VALUE.attrs['00400100'].Value[0] && mwl._VALUE.attrs['00400100'].Value[0]['00400001'] &&  mwl._VALUE.attrs['00400100'].Value[0]['00400001'].Value && mwl._VALUE.attrs['00400100'].Value[0]['00400001'].Value[0]" tooltip="{{mwl._VALUE.attrs['00400100'].Value[0]['00400001'].Value[0]}}">
                                        {{(mwl._VALUE.attrs['00400100'].Value[0]['00400001'].Value[0]) || '&nbsp;'}}
                                    </div>
                                </div>
                            </div>
                            <div class="td_row">
                                <div class="tr_row"  *ngIf="mwl._VALUE.showAttributes">
                                    <div class="td_cell attribute_list" id="{{patient._VALUE.attrs['00100020'].Value[0] | removedots}}{{mwl._VALUE.attrs['0020000D'].Value[0] | removedots}}">
                                        <attribute-list *ngIf="mwl._VALUE.attrs" [attrs]="mwl._VALUE.attrs"></attribute-list>
                                    </div>
                                </div>
                            </div>
                            <div class="arrows" *ngIf="mwl._VALUE.series && mwl._VALUE.series.length">
                                <div class="arrows_block">
                                    <button class="btn btn-link btn-xs"
                                            [disabled]="mwl._VALUE.series[0].offset==0"
                                            (click)="querySeries(mwl._VALUE, mwl._VALUE.series[0].offset-limit)"
                                            title="Previous Series">
                                        <span class="glyphicon glyphicon-menu-left"></span>
                                    </button>
                                    <button class="btn btn-link btn-xs"
                                            [disabled]="!mwl._VALUE.moreSeries"
                                            (click)="querySeries(mwl._VALUE, mwl._VALUE.series[0].offset+limit)"
                                            title="Next Series">
                                        <span class="glyphicon glyphicon-menu-right"></span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
            </ng-container>
            <div class="arrows" *ngIf="patient._VALUE && patient._VALUE.studies && patient._VALUE.studies[0] && patient._VALUE.studies[0].fromAllStudies">
                <div class="arrows_block">
                    <button class="btn btn-link btn-xs"
                            [disabled]="patient._VALUE && patient._VALUE.studies && patient._VALUE.studies[0] && patient._VALUE.studies[0].offset===0"
                            (click)="queryAllStudiesOfPatient(patient._VALUE, patient._VALUE[0]?.offset-limit, $event)"
                            title="Previous studies">
                        <span class="glyphicon glyphicon-menu-left"></span>
                    </button>
                    <button class="btn btn-link btn-xs"
                            [disabled]="!patient._VALUE.moreStudies"
                            (click)="queryAllStudiesOfPatient(patient._VALUE, patient._VALUE[0]?.offset+limit, $event)"
                            title="Next studies">
                        <span class="glyphicon glyphicon-menu-right"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="arrows">
        <div class="arrows_block" *ngIf="morePatients || (patients[0] && patients[0].offset && patients[0].offset != 0)" >
            <button class="btn btn-link btn-xs"
                    [disabled]="!patients[0] || !patients[0].offset || patients[0].offset === 0"
                    (click)="queryPatients(patients[0].offset-limit);addEffect('left')"
                    title="Previous Patients">
                <span class="glyphicon glyphicon glyphicon-chevron-left"></span>
            </button>
            <button class="btn btn-link btn-xs"
                    [disabled]="!morePatients"
                    (click)="queryPatients(patients[0].offset+limit);addEffect('right')"
                    title="Next Patients">
                <span class="glyphicon glyphicon glyphicon-chevron-right"></span>
            </button>
        </div>
        <div class="arrows_block" *ngIf="(moreStudies || (patients[0] && patients[0].studies && patients[0].studies[0] && patients[0].studies[0].offset != 0)) && filterMode === 'diff'" >
            <button class="btn btn-link btn-xs"
                    [disabled]="!patients[0] || !patients[0].studies || !patients[0].studies[0] || patients[0].studies[0].offset === 0"
                    (click)="queryDiffs(patients[0].studies[0].offset-limit);addEffect('left')"
                    title="Previous Diffs">
                <span class="glyphicon glyphicon glyphicon-chevron-left"></span>
            </button>
            <button class="btn btn-link btn-xs"
                    [disabled]="!moreStudies"
                    (click)="queryDiffs(patients[0].studies[0].offset+limit);addEffect('right')"
                    title="Next Diffs">
                <span class="glyphicon glyphicon glyphicon-chevron-right"></span>
            </button>
        </div>
        <div class="arrows_block" *ngIf="(moreStudies || (patients[0] && patients[0].studies && patients[0].studies[0] && patients[0].studies[0].offset != 0)) && filterMode === 'study'" >
            <button class="btn btn-link btn-xs"
                    [disabled]="!patients[0] || !patients[0].studies || !patients[0].studies[0] || patients[0].studies[0].offset === 0"
                    (click)="queryStudies(patients[0].studies[0].offset-limit);addEffect('left')"
                    title="Previous Studies">
                <span class="glyphicon glyphicon glyphicon-chevron-left"></span>
            </button>
            <button class="btn btn-link btn-xs"
                    [disabled]="!moreStudies"
                    (click)="queryStudies(patients[0].studies[0].offset+limit);addEffect('right')"
                    title="Next Studies">
                <span class="glyphicon glyphicon glyphicon-chevron-right"></span>
            </button>
        </div>
        <div class="arrows_block" *ngIf="moreMWL" >
            <button class="btn btn-link btn-xs"
                    [disabled]="patients[0].mwls[0].offset === 0"
                    (click)="queryMWL(patients[0].mwls[0].offset-limit);addEffect('left')"
                    title="Previous MWL">
                <span class="glyphicon glyphicon glyphicon-chevron-left"></span>
            </button>
            <button class="btn btn-link btn-xs"
                    [disabled]="!moreMWL"
                    (click)="queryMWL(patients[0].mwls[0].offset+limit);addEffect('right')"
                    title="Next MWL">
                <span class="glyphicon glyphicon glyphicon-chevron-right"></span>
            </button>
        </div>
    </div>
</div>